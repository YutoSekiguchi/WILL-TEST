!function(){"use strict";"undefined"==typeof document||document.currentScript.src;function t(t,e){return e.forEach((function(e){Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}))})),Object.freeze(t)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t,e){if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return s(t)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function h(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function y(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}function v(t,e){if(e&&("object"===p(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function m(t){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function x(t,e,n){return e&&b(t.prototype,e),n&&b(t,n),t}function P(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return w(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function E(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=m(t);if(e){var i=m(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return v(this,n)}}var S=function(){function t(){g(this,t)}return x(t,null,[{key:"overrides",get:function(){return["toString"]}},{key:"extend",value:function(t){var e,n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return"string"==typeof t?(e=t,t=globalThis[e]):e=t.name,t?(this.debug&&console.log("============================================================ extend",t.name,r.name),Object.getOwnPropertyNames(r.prototype).filter((function(t){return"constructor"!=t})).forEach((function(e){!(e in t.prototype)||r.overrides.includes(e)?(n.debug&&(r.overrides.includes(e)?console.log("%coverride ".concat(e),"color: chartreuse"):console.log("%cdefine ".concat(e),"color: green")),t.prototype[e]=r.prototype[e]):n.debug&&console.log("%cexclude ".concat(e),"color: red")})),Object.getOwnPropertyNames(r).forEach((function(e){"function"==typeof r[e]&&"extend"!=e&&(!(e in t)||r.overrides.includes(e)?(n.debug&&(r.overrides.includes(e)?console.log("%coverride static ".concat(e),"color: chartreuse"):console.log("%cdefine static ".concat(e),"color: orange")),t[e]=r[e]):n.debug&&console.log("%cexclude static ".concat(e),"color: red"))})),r.properties&&Object.keys(r.properties).forEach((function(e){e in t.prototype?n.debug&&console.log("%cexclude prop ".concat(e),"color: red"):r.properties[e]&&(n.debug&&console.log("%cdefine prop ".concat(e),"color: darkseagreen"),Object.defineProperty(t.prototype,e,r.properties[e]))})),r.classProperties&&Object.keys(r.classProperties).forEach((function(e){e in t?n.debug&&console.log("%cexclude static prop ".concat(e),"color: red"):r.classProperties[e]&&(n.debug&&console.log("%cdefine static prop ".concat(e),"color: chocolate"),Object.defineProperty(t,e,r.classProperties[e]))})),!0):(this.debug&&console.warn("============================================================ Class ".concat(e," not found")),!1)}}]),t}(),k=function(){function t(e,n,r){g(this,t),Object.defineProperty(this,"type",{value:e,enumerable:!0}),Object.defineProperty(this,"name",{value:n,enumerable:!0}),Object.defineProperty(this,"value",{value:r,enumerable:!0})}return x(t,[{key:"toString",value:function(){return this.name}}]),t}(),O=function(t){y(n,t);var e=E(n);function n(){return g(this,n),e.apply(this,arguments)}return x(n,null,[{key:"equals",value:function(t,e){if(t===e)return!0;if(!(t instanceof Object&&e instanceof Object))return!1;if(t.constructor!==e.constructor)return!1;if(t instanceof Array||ArrayBuffer.isTypedArray(t))return t.length==e.length&&t.every((function(t,n){return Object.equals(t,e[n])}));for(var n in t)if(t.hasOwnProperty(n)){if(!e.hasOwnProperty(n))return!1;if(t[n]!==e[n]){if("object"!==p(t[n]))return!1;if(!Object.equals(t[n],e[n]))return!1}}for(var r in e)if(e.hasOwnProperty(r)&&!t.hasOwnProperty(r))return!1;return!0}},{key:"clone",value:function(t,e){var n=new Array;return function t(r){if(null===r)return null;if("object"!==p(r)||r.immutable)return r;if("function"==typeof r.clone)return r.clone();for(var i=0;i<n.length;i++)if(n[i][0]===r)return n[i][1];var o=Object.create(Object.getPrototypeOf(r));for(var a in n.push([r,o]),r)e&&"function"==typeof r[a]||r.hasOwnProperty(a)&&(o[a]=t(r[a]));return o}(t)}},{key:"toSource",value:function(t,e){if("object"==p(t)){var n=[];for(var r in t)t.hasOwnProperty(r)&&n.push("".concat(r,": ").concat(Object.toSource(t[r])));return(e?"".concat(e," = "):"")+"{"+n.join(", ")+"}"}if("function"==typeof t){var i=t.toString();return t.name&&i.startsWith(t.name)&&(i="function "+i),i}return t}},{key:"defineEnum",value:function(t,e,n){if(t[e])throw new Error("Already exist property: ".concat(e));var r={values:n.map((function(t,n){return new k(e,t,n)}))};return r.values.forEach((function(t){Object.defineProperty(r,t.name,{value:t,enumerable:!0}),Object.defineProperty(r,t.value,{value:t,enumerable:!0})})),Object.defineProperty(t,e,{value:r,enumerable:!0}),r}}]),n}(S),I=function(t){y(n,t);var e=E(n);function n(){return g(this,n),e.apply(this,arguments)}return x(n,[{key:"startsWith",value:function(t){return this.length>=t.length&&this.substring(0,t.length)==t}},{key:"endsWith",value:function(t){return this.length>=t.length&&this.substring(this.length-t.length,this.length)==t}},{key:"includes",value:function(t){return-1!=this.indexOf(t)}},{key:"contains",value:function(t){return this.includes(t)}},{key:"containsIgnoreCase",value:function(t){return-1!=this.toUpperCase().indexOf(t.toUpperCase())}},{key:"pad",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return this.length<t?new Array(t-this.length+1).join(e)+this:this.toString()}},{key:"toCharArray",value:function(t){for(var e=[],n=!0,r=0;r<this.length;r++){var i=this.charCodeAt(r);i>255&&(n=!1),e[r]=i}if(t){if(!n)throw new Error("Current value is not byte string");e=new Uint8Array(e)}return e}}],[{key:"fromCharArray",value:function(t){var e="";try{e=String.fromCharCode.apply(null,t)}catch(r){for(var n=0;n<t.length;n++)e+=String.fromCharCode(t[n])}return e}}]),n}(S),M=function(t){y(n,t);var e=E(n);function n(){return g(this,n),e.apply(this,arguments)}return x(n,[{key:"pad",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0";return String(this).length<t?new Array(t-String(this).length+1).join(e)+String(this):this.toString()}},{key:"toFloat32",value:function(){var t=new Float32Array(1);return t[0]=this,t[0]}}]),n}(S);f(M,"classProperties",{MAX_INT32:{value:2147483647,enumerable:!0},MAX_UINT32:{value:4294967295,enumerable:!0},MAX_INT64:"undefined"==typeof BigInt?void 0:{value:0x7FFFFFFFFFFFFFFFn,enumerable:!0},MAX_UINT64:"undefined"==typeof BigInt?void 0:{value:0xFFFFFFFFFFFFFFFFn,enumerable:!0}}),f(M,"properties",{length:{get:function(){return 1+(0|Math.log10((this^this>>31)-(this>>31)))},configurable:!0}});var _=function(t){y(n,t);var e=E(n);function n(){return g(this,n),e.apply(this,arguments)}return x(n,null,[{key:"createClass",value:function(t,e){return new Function(e?e.name:void 0,"return class ".concat(t).concat(e?" extends ".concat(e.name):""," {\n\t\t\tconstructor() {\n\t\t\t\t").concat(e?"super(...arguments);":"","\n\t\t\t}\n\t\t}"))(e)}}]),n}(S);f(_,"properties",{body:{get:function(){var t=this.toString();return t=t.substring(t.indexOf("{")+1,t.lastIndexOf("}"))},configurable:!0}});var T=function(t){y(n,t);var e=E(n);function n(){return g(this,n),e.apply(this,arguments)}return x(n,[{key:"clear",value:function(){this.length=0}},{key:"includes",value:function(t){return this.indexOf(t)>-1}},{key:"clone",value:function(){if(!Object.clone)throw new Error("Object extension is required");return this.map((function(t){return Object.clone(t)}))}},{key:"unique",value:function(){var t=this;return this.filter((function(e,n){return t.indexOf(e)==n}))}},{key:"add",value:function(t){return!this.includes(t)&&(this.push(t),!0)}},{key:"insert",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.splice(e,0,t)}},{key:"indicesOf",value:function(t){var e=[],n=this.indexOf(t);if(-1!=n){e.push(n);for(var r=this.lastIndexOf(t);r>n;)n=this.indexOf(t,n+1),e.push(n)}return e}},{key:"remove",value:function(){for(var t=this,e=function(t){var e=[],n=-1;return t.forEach((function(t){n-t!=1&&e.push([]),e.last.push(t),n=t})),e},n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var o=r.map((function(e){return t.indicesOf(e)})).flat().sort((function(t,e){return e-t}));return e(o).forEach((function(e){return t.removeAt(e.last,e.length)})),this}},{key:"removeAt",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t>-1&&this.splice(t,e),this}},{key:"replace",value:function(t,e,n){var r=this.indexOf(t);return r>-1&&(!n&&e instanceof Array?this.splice.apply(this,[r,1].concat(h(e))):this.splice(r,1,e)),this}}],[{key:"from",value:function(t){return Array.prototype.slice.call(t)}}]),n}(S);f(T,"properties",{first:{get:function(){return this[0]},configurable:!0},last:{get:function(){return this[this.length-1]},configurable:!0}});var A=function(t){y(n,t);var e=E(n);function n(){return g(this,n),e.apply(this,arguments)}return x(n,[{key:"toBase64",value:function(){if(!String.fromCharArray)throw new Error("String extension is required");var t=new Uint8Array(this);return btoa(String.fromCharArray(t))}}],[{key:"fromBase64",value:function(t){if(!String.prototype.toCharArray)throw new Error("String extension is required");return atob(t).toCharArray(!0).buffer}},{key:"isTypedArray",value:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}}]),n}(S),C=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"],R=function(t){y(n,t);var e=E(n);function n(){return g(this,n),e.apply(this,arguments)}return x(n,[{key:"clone",value:function(){if("undefined"!=typeof SharedArrayBuffer&&this.buffer instanceof SharedArrayBuffer){var t=new SharedArrayBuffer(this.byteLength),e=new this.constructor(t);return e.set(this,this.byteOffset),e}return new this.constructor(this,this.byteOffset,this.length)}},{key:"concat",value:function(){for(var t,e=this,n=this.length,r=this.length,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return o.forEach((function(t){if(e.constructor!=t.constructor)throw new Error("Concat array from wrong type detected - expected ".concat(e.constructor.name,", found ").concat(t.constructor.name));n+=t.length})),(t="undefined"!=typeof SharedArrayBuffer&&this.buffer instanceof SharedArrayBuffer?this.constructor.createSharedInstance(n):new this.constructor(n)).set(this),o.forEach((function(e){t.set(e,r),r+=e.length})),t}},{key:"toArray",value:function(){return Array.from(this)}}],[{key:"createSharedInstance",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(t instanceof this)return t;if("number"!=typeof t&&!Array.isArray(t))throw new Error("Expected data type is Array");var e="number"==typeof t?t:t.length;if("undefined"==typeof SharedArrayBuffer)return new this("number"==typeof t?e:t);var n=new SharedArrayBuffer(e*this.BYTES_PER_ELEMENT);if("number"==typeof t)return new this(n);var r=new this(n);return r.set(t),r}},{key:"from",value:function(t){return new this(t)}},{key:"extend",value:function(){var t=this;C.forEach((function(e){if(S.extend(e+"Array",t)){var n=globalThis[e+"Array"];Array.prototype["to"+e+"Array"]=function(){return n.from(this)}}}))}}]),n}(S),N=function(t){y(n,t);var e=E(n);function n(){return g(this,n),e.apply(this,arguments)}return x(n,[{key:"map",value:function(t){var e,n=new Set,r=P(this);try{for(r.s();!(e=r.n()).done;){var i=e.value;(i=t(i))&&n.add(i)}}catch(t){r.e(t)}finally{r.f()}return n}},{key:"filter",value:function(t){var e,n=new Set,r=P(this);try{for(r.s();!(e=r.n()).done;){var i=e.value;t(i)&&n.add(i)}}catch(t){r.e(t)}finally{r.f()}return n}}]),n}(S),F=function(t){y(n,t);var e=E(n);function n(){return g(this,n),e.apply(this,arguments)}return n}(S);f(F,"properties",{size:{get:function(){return{width:Math.floor(screen.width),height:Math.floor(screen.height)}},configurable:!0},resolution:{get:function(){return{width:Math.floor(screen.width*devicePixelRatio),height:Math.floor(screen.height*devicePixelRatio)}},configurable:!0}});var D=function(t){y(n,t);var e=E(n);function n(){return g(this,n),e.apply(this,arguments)}return x(n,null,[{key:"properties",get:function(){return{query:{get:function(){if(!this._query){var t=Object.assign.apply(Object,[{}].concat(h(this.search.substring(1).split("&").filter((function(t){return t})).map((function(t){return t.split("=")})).map((function(t){return f({},t[0],decodeURIComponent(t[1]))})))));Object.defineProperty(this,"_query",{value:t})}return this._query},configurable:!0}}}}]),n}(S),j=function(t){y(n,t);var e=E(n);function n(){return g(this,n),e.apply(this,arguments)}return x(n,[{key:"getInlineStyle",value:function(t){return this.style[t]||this.style["-webkit-"+t]||this.style["-khtml-"+t]||this.style["-moz-"+t]||this.style["-ms-"+t]||this.style["-o-"+t]||""}},{key:"setStyle",value:function(t,e){var n=this;["-webkit","-khtml","-moz","-ms","-o"].forEach((function(r){return n.style[r+"-"+t]=e})),this.style[t]=e}},{key:"getStyle",value:function(t){var e=t,n=t.startsWith("-");n&&(e=t.substring(1));for(var r=e.split("-"),i=r.length-1;i>0;i--)r[i]=r[i].substring(0,1).toUpperCase()+r[i].substring(1);e=r.join("");var o=this.style.display,a=this.style.visibility;"none"==o&&(this.style.visibility="hidden",this.style.display="");var s=window.getComputedStyle(this)[e];if(!n&&void 0===s)for(var u=["-webkit","-khtml","-moz","-ms","-o"],c=0;c<u.length&&"undefined"==(s=this.getStyle(u[c]+"-"+t));c++);return"none"==o&&(this.style.visibility=a,this.style.display="none"),s}},{key:"getMathStyle",value:function(t,e){var n=e?this.getInlineStyle(t):this.getStyle(t);return"auto"==n&&(n=0),parseFloat(n)}},{key:"getTransformStyle",value:function(){var t={translate:{x:0,y:0},scale:{x:1,y:1},rotate:{angle:0},skew:{angleX:0,angleY:0},matrix:{a:1,b:0,c:0,d:1,tx:0,ty:0}},e=this.getStyle("transform");if("none"!=e){var n=e.substring(e.indexOf("(")+1,e.indexOf(")")).split(/,\s*/g),r=parseFloat(n[0]),i=parseFloat(n[1]),o=parseFloat(n[2]),a=parseFloat(n[3]),s=parseFloat(n[4]),u=parseFloat(n[5]);t.scale={x:Math.sqrt(r*r+o*o),y:Math.sqrt(a*a+i*i)},t.skew={angleX:Math.tan(o),angleY:Math.tan(i)},t.rotate={angle:Math.atan2(i,r)},t.translate={x:s,y:u},t.matrix={a:r,b:i,c:o,d:a,tx:s,ty:u}}return t}},{key:"toRect",value:function(){var t=this.style.display,e=this.style.visibility;"none"==t&&(this.style.visibility="hidden",this.style.display="");var n=this.offsetWidth+this.getMathStyle("margin-left")+this.getMathStyle("margin-right"),r=this.offsetHeight+this.getMathStyle("margin-top")+this.getMathStyle("margin-bottom"),i=new DOMRect(this.offsetLeft,this.offsetTop,this.offsetWidth,this.offsetHeight);return i.outerSize=new DOMSize(n,r),"none"==t&&(this.style.visibility=e,this.style.display="none"),i}}]),n}(S),L=function(t){y(n,t);var e=E(n);function n(){return g(this,n),e.apply(this,arguments)}return x(n,[{key:"toDataURL",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"png",e=document.createElement("canvas");return e.width=this.width,e.height=this.height,e.getContext("2d").drawImage(this,0,0),e.toDataURL("image/".concat(t))}},{key:"toBlob",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"png";return new Blob([this.toArrayBuffer(t)],{type:"image/".concat(t)})}},{key:"toArrayBuffer",value:function(t){if(!ArrayBuffer.fromBase64)throw new Error("ArrayBuffer extension is required");var e=this.toDataURL(t).split(",")[1];return ArrayBuffer.fromBase64(e)}}]),n}(S),B=function(t){y(n,t);var e=E(n);function n(){return g(this,n),e.apply(this,arguments)}return x(n,null,[{key:"fromBytes",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"png",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Image;return new Promise((function(r,i){n.onload=function(){URL.revokeObjectURL(n.src),r(n)},n.onerror=i,n.src=URL.createObjectURL(new Blob([t.buffer||t],{type:"image/".concat(e)}))}))}}]),n}(S),z=function(t){y(n,t);var e=E(n);function n(){return g(this,n),e.apply(this,arguments)}return x(n,null,[{key:"extend",value:function(){"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.clearCanvas=function(t){this.clearRect(0,0,this.canvas.width,this.canvas.height),t&&(this.fillStyle=t,this.fillRect(0,0,this.canvas.width,this.canvas.height))},"undefined"==typeof OffscreenCanvas?(globalThis.OffscreenCanvas=function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n},globalThis.OffscreenCanvasRenderingContext2D=CanvasRenderingContext2D):"undefined"!=typeof OffscreenCanvasRenderingContext2D&&(OffscreenCanvasRenderingContext2D.prototype.clearCanvas=CanvasRenderingContext2D.prototype.clearCanvas))}}]),n}(S),Y=function(t){y(n,t);var e=E(n);function n(){return g(this,n),e.apply(this,arguments)}return x(n,[{key:"transform",value:function(t){return t instanceof DOMMatrix||(t=DOMMatrix.fromMatrix(t)),this.matrixTransform(t)}},{key:"toString",value:function(){return"point(".concat(this.x,", ").concat(this.y,", ").concat(this.z,")")}}]),n}(S),X=function(){function t(e,n){g(this,t),this.width=e,this.height=n}return x(t,[{key:"toJSON",value:function(){return{width:this.width,height:this.height}}},{key:"toString",value:function(){return"size(".concat(this.width,", ").concat(this.height,")")}}],[{key:"fromSize",value:function(e){if(e instanceof t)return e;if("string"==typeof e){if(!e.startsWith("size("))throw new Error("Invalid value found. Expected template - size(width, height).");var n=e.substring(e.indexOf("(")+1,e.indexOf(")")).split(/,\s*/g);e={width:parseFloat(n[0]),height:parseFloat(n[1])}}if(isNaN(e.width))throw new Error("Invalid width found, expected number");if(isNaN(e.height))throw new Error("Invalid height found, expected number");return new t(e.width,e.height)}}]),t}(),W=function(t){y(n,t);var e=E(n);function n(){return g(this,n),e.apply(this,arguments)}return x(n,[{key:"union",value:function(t){return t?DOMRect.ofEdges(Math.min(this.left,t.left),Math.min(this.top,t.top),Math.max(this.right,t.right),Math.max(this.bottom,t.bottom)):this}},{key:"intersect",value:function(t){if(t){var e=DOMRect.ofEdges(Math.max(this.left,t.left),Math.max(this.top,t.top),Math.min(this.right,t.right),Math.min(this.bottom,t.bottom));return e.width>0&&e.height>0?e:void 0}}},{key:"ceil",value:function(t){var e=Math.floor(this.left),n=Math.floor(this.top),r=Math.ceil(this.right),i=Math.ceil(this.bottom);if(t){var o=this.width,a=this.height;r=e+(o+=o%2),i=n+(a+=a%2)}return DOMRect.ofEdges(e,n,r,i)}},{key:"floor",value:function(t){var e=Math.ceil(this.left),n=Math.ceil(this.top),r=Math.floor(this.right),i=Math.floor(this.bottom);if(t){var o=this.width,a=this.height;r=e+(o-=o%2),i=n+(a-=a%2)}return DOMRect.ofEdges(e,n,r,i)}},{key:"contains",value:function(t){return this.left<=t.x&&this.right>=t.x&&this.top<=t.y&&this.bottom>=t.y}},{key:"transform",value:function(t){t instanceof DOMMatrix||(t=DOMMatrix.fromMatrix(t));var e=DOMPoint.fromPoint({x:this.left,y:this.top}).transform(t),n=DOMPoint.fromPoint({x:this.right,y:this.top}).transform(t),r=DOMPoint.fromPoint({x:this.left,y:this.bottom}).transform(t),i=DOMPoint.fromPoint({x:this.right,y:this.bottom}).transform(t),o=Math.min(e.x,n.x,r.x,i.x),a=Math.min(e.y,n.y,r.y,i.y),s=Math.max(e.x,n.x,r.x,i.x),u=Math.max(e.y,n.y,r.y,i.y);return DOMRect.ofEdges(o,a,s,u)}},{key:"matrixTransform",value:function(t){return this.transform(t)}},{key:"toPath",value:function(){var t=[];return t.push(this.left,this.top),t.push(this.right,this.top),t.push(this.right,this.bottom),t.push(this.left,this.bottom),t.push(this.left,this.top),t.toFloat32Array()}},{key:"toString",value:function(){return"rect(".concat(this.x,", ").concat(this.y,", ").concat(this.width,", ").concat(this.height,")")}}],[{key:"ofEdges",value:function(t,e,n,r){return new DOMRect(t,e,n-t,r-e)}},{key:"extend",value:function(){S.extend("DOMRect",this)&&(globalThis.DOMSize=X)}}]),n}(S);f(W,"properties",{size:{get:function(){return new X(this.width,this.height)},configurable:!0},center:{get:function(){return new DOMPoint((this.left+this.right)/2,(this.top+this.bottom)/2)},configurable:!0}});var V=function(t){y(n,t);var e=E(n);function n(){return g(this,n),e.apply(this,arguments)}return x(n,[{key:"preMultiply",value:function(t){var e=t.postMultiply(this);return e.multiplicationType=this.multiplicationType,e}},{key:"multiply",value:function(t){if(t instanceof DOMMatrix||(t=DOMMatrix.fromMatrix(t)),this.multiplicationType==DOMMatrix.MultiplicationType.POST)return this.postMultiply(t);var e=this.preMultiply(t);return e.multiplicationType=DOMMatrix.MultiplicationType.PRE,e}},{key:"multiplySelf",value:function(t){t instanceof DOMMatrix||(t=DOMMatrix.fromMatrix(t)),this.multiplicationType==DOMMatrix.MultiplicationType.POST?this.postMultiplySelf(t):this.preMultiplySelf(t)}},{key:"transformPoint",value:function(t){return DOMPoint.fromPoint(t).matrixTransform(this)}},{key:"invert",value:function(){return this.inverse()}},{key:"decompose",value:function(){return{translate:{x:this.tx,y:this.ty},rotate:{angle:Math.atan2(this.b,this.a)},skew:{angleX:Math.tan(this.c),angleY:Math.tan(this.b)},scale:{x:Math.sqrt(this.a*this.a+this.c*this.c),y:Math.sqrt(this.d*this.d+this.b*this.b)},matrix:this}}},{key:"disassemble",value:function(){return console.warn("disassemble is deprecated, use decompose instead"),this.decompose()}},{key:"toString",value:function(t){if(!t)return this.nativeToString();var e=function(t){return((t<0?"":" ")+t.toPrecision(6)).substring(0,8)};return" Matrix 4x4\n"+"-".repeat(39)+"\n".concat(e(this.m11),", ").concat(e(this.m21),", ").concat(e(this.m31),", ").concat(e(this.m41))+"\n".concat(e(this.m12),", ").concat(e(this.m22),", ").concat(e(this.m32),", ").concat(e(this.m42))+"\n".concat(e(this.m13),", ").concat(e(this.m23),", ").concat(e(this.m33),", ").concat(e(this.m43))+"\n".concat(e(this.m14),", ").concat(e(this.m24),", ").concat(e(this.m34),", ").concat(e(this.m44))}}],[{key:"fromMatrix",value:function(t,e){var n;return"string"==typeof t?n=new DOMMatrix(t):("e"in t||(t.e=t.tx||t.dx),"f"in t||(t.f=t.ty||t.dy),n=DOMMatrix.nativeFromMatrix(t)),n.multiplicationType=e||t.multiplicationType||DOMMatrix.MultiplicationType.POST,n}},{key:"fromTranslate",value:function(t){var e=isFinite(t)?{tx:t,ty:t}:{tx:t.x,ty:t.y};return DOMMatrix.fromMatrix(e)}},{key:"fromRotate",value:function(t,e){var n=Math.sin(t),r=Math.cos(t),i={a:r,b:n,c:-n,d:r};return e&&(i.tx=e.x-e.x*r+e.y*n,i.ty=e.y-e.x*n-e.y*r),DOMMatrix.fromMatrix(i)}},{key:"fromScale",value:function(t,e){isFinite(t)&&(t={x:t,y:t});var n={a:t.x,d:t.y};return e&&(n.tx=e.x-e.x*t.x,n.ty=e.y-e.y*t.y),DOMMatrix.fromMatrix(n)}},{key:"fromPoints",value:function(t,e){var n=DOMMatrix.fromMatrix({m11:t[0].x,m21:t[1].x,m31:t[2].x,m12:t[0].y,m22:t[1].y,m32:t[2].y,m13:1,m23:1,m33:1}),r=DOMMatrix.fromMatrix({m11:e[0].x,m21:e[1].x,m31:e[2].x,m12:e[0].y,m22:e[1].y,m32:e[2].y,m13:1,m23:1,m33:1}),i=n.invert().preMultiply(r);return DOMMatrix.fromMatrix({a:i.m11,b:i.m12,c:i.m21,d:i.m22,tx:i.m31,ty:i.m32})}},{key:"extend",value:function(){if("undefined"==typeof DOMMatrix||DOMMatrix.nativeFromMatrix)return!1;DOMMatrix.nativeFromMatrix=DOMMatrix.fromMatrix,DOMMatrix.prototype.nativeToString=DOMMatrix.prototype.toString,DOMMatrix.prototype.postMultiply=DOMMatrix.prototype.multiply,DOMMatrix.prototype.postMultiplySelf=DOMMatrix.prototype.multiplySelf,S.extend("DOMMatrix",this)}}]),n}(S);f(V,"overrides",S.overrides.concat(["fromMatrix","multiply","multiplySelf","transformPoint"])),f(V,"properties",{tx:{get:function(){return this.e},set:function(t){this.e=t},enumerable:!0},ty:{get:function(){return this.f},set:function(t){this.f=t},enumerable:!0},dx:{get:function(){return this.e},set:function(t){this.e=t},enumerable:!0},dy:{get:function(){return this.f},set:function(t){this.f=t},enumerable:!0},multiplicationType:{value:"POST",enumerable:!0,writable:!0}}),f(V,"classProperties",{MultiplicationType:{value:{PRE:"PRE",POST:"POST"},enumerable:!0}});var U=Object.freeze({__proto__:null,ObjectExt:O,StringExt:I,NumberExt:M,FunctionExt:_,ArrayExt:T,ArrayBufferExt:A,TypedArrayExt:R,SetExt:N,ScreenExt:F,LocationExt:D,HTMLElementExt:j,HTMLImageElementExt:L,ImageExt:B,CanvasExt:z,DOMPointExt:Y,DOMRectExt:W,DOMMatrixExt:V});function q(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function J(t,e,n){return(J=q()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&i(o,n.prototype),o}).apply(null,arguments)}function G(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function Z(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){G(o,r,i,a,s,"next",t)}function s(t){G(o,r,i,a,s,"throw",t)}a(void 0)}))}}"undefined"==typeof globalThis&&("undefined"!=typeof window?window.globalThis=window:"undefined"!=typeof self?self.globalThis=self:"undefined"!=typeof global&&(global.globalThis=global)),Math.toDegrees=function(t){return t*(180/this.PI)},Math.toRadians=function(t){return t*(this.PI/180)},Math.randomInt=function(t,e){return Math.floor(this.random()*(e-t+1))+t},Function.prototype.createEnum=function(t,e){console.warn("createEnum is deprecated, please update ".concat(t," enum with Object.defineEnum(target, name, values)")),Object.defineEnum(this,t,e)},"function"==typeof Worker&&(Worker.prototype.on=function(t,e){this["on".concat(t)]=function(n){var r="message"==t?n.data:n;e(r)}}),"function"==typeof DedicatedWorkerGlobalScope&&(DedicatedWorkerGlobalScope.prototype.on=function(t,e){this["on".concat(t)]=function(n){var r="message"==t?n.data:n;e(r)}}),globalThis.JS_EXT_SCOPE||Object.defineProperty(globalThis,"JS_EXT_SCOPE",{value:["Object","String","Number","Function","Array","ArrayBuffer","TypedArray","Set","Screen","Location","HTMLElement","HTMLImageElement","Image","Canvas","DOMPoint","DOMRect","DOMMatrix"],enumerable:!0,configurable:!0}),globalThis.JS_EXT_SCOPE.forEach((function(t){var e=U["".concat(t,"Ext")];if(!e)throw new Error("Extension ".concat(t," not found"));e.extend(t)}));var H="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},K={exports:{}};!function(t){var e=function(t){var e,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,o=Object.create(i.prototype),a=new M(r||[]);return o._invoke=function(t,e,n){var r=h;return function(i,o){if(r===p)throw new Error("Generator is already running");if(r===d){if("throw"===i)throw o;return T()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=k(a,n);if(s){if(s===y)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=p;var u=l(t,e,n);if("normal"===u.type){if(r=n.done?d:f,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=d,n.method="throw",n.arg=u.arg)}}}(t,n,a),o}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var h="suspendedStart",f="suspendedYield",p="executing",d="completed",y={};function v(){}function m(){}function g(){}var b={};u(b,o,(function(){return this}));var x=Object.getPrototypeOf,P=x&&x(x(_([])));P&&P!==n&&r.call(P,o)&&(b=P);var w=g.prototype=v.prototype=Object.create(b);function E(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function n(i,o,a,s){var u=l(t[i],t,o);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==typeof h&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function k(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,k(t,n),"throw"===n.method))return y;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var i=l(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var o=i.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function M(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function _(t){if(t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}return{next:T}}function T(){return{value:e,done:!0}}return m.prototype=g,u(w,"constructor",g),u(g,"constructor",m),m.displayName=u(g,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,u(t,s,"GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},E(S.prototype),u(S.prototype,a,(function(){return this})),t.AsyncIterator=S,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new S(c(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(w),u(w,s,"Generator"),u(w,o,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=_,M.prototype={constructor:M,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),I(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:_(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),y}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}(K);var $=K.exports;"function"==typeof Worker&&(Worker.prototype.on=function(t,e){this["on".concat(t)]=function(n){var r="message"==t?n.data:n;e(r)}}),"function"==typeof DedicatedWorkerGlobalScope&&(DedicatedWorkerGlobalScope.prototype.on=function(t,e){this["on".concat(t)]=function(n){var r="message"==t?n.data:n;e(r)}});var Q=function(){function t(){e(this,t),this.worker,this.transferables=[]}var n,i,o,a;return r(t,[{key:"recieve",value:(a=Z($.mark((function t(e){var n;return $.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("INIT"!=e.action){t.next=7;break}return this.worker=e.worker,t.next=4,this.init(e);case 4:n=t.sent,t.next=10;break;case 7:return t.next=9,this.process(e);case 9:n=t.sent;case 10:n.worker=this.worker,this.send(n);case 12:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"send",value:function(t){self.postMessage(t,this.transferables),this.transferables.length=0}},{key:"init",value:(o=Z($.mark((function t(e){return $.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e);case 1:case"end":return t.stop()}}),t)}))),function(t){return o.apply(this,arguments)})},{key:"process",value:(i=Z($.mark((function t(e){return $.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("ThreadProcessor.process(message) is abstract and should be implemented");case 1:case"end":return t.stop()}}),t)}))),function(t){return i.apply(this,arguments)})}],[{key:"connect",value:(n=Z($.mark((function t(){var e,n,r,i,o,a,s,u=arguments;return $.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e=u.length,n=new Array(e),r=0;r<e;r++)n[r]=u[r];if(i=J(this,n),"undefined"!=typeof self){t.next=10;break}return t.next=5,import("worker_threads");case 5:o=t.sent,a=o.parentPort,s=o.workerData,global.self=a,self.name=s.name,self.data=s;case 10:self.on("message",function(){var t=Z($.mark((function t(e){return $.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.recieve(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 11:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})}]),t}(),tt=1e-6,et="undefined"!=typeof Float32Array?Float32Array:Array,nt=Math.random;function rt(){var t=new et(16);return et!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function it(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],h=e[9],f=e[10],p=e[11],d=e[12],y=e[13],v=e[14],m=e[15],g=n*s-r*a,b=n*u-i*a,x=n*c-o*a,P=r*u-i*s,w=r*c-o*s,E=i*c-o*u,S=l*y-h*d,k=l*v-f*d,O=l*m-p*d,I=h*v-f*y,M=h*m-p*y,_=f*m-p*v,T=g*_-b*M+x*I+P*O-w*k+E*S;return T?(T=1/T,t[0]=(s*_-u*M+c*I)*T,t[1]=(i*M-r*_-o*I)*T,t[2]=(y*E-v*w+m*P)*T,t[3]=(f*w-h*E-p*P)*T,t[4]=(u*O-a*_-c*k)*T,t[5]=(n*_-i*O+o*k)*T,t[6]=(v*x-d*E-m*b)*T,t[7]=(l*E-f*x+p*b)*T,t[8]=(a*M-s*O+c*S)*T,t[9]=(r*O-n*M-o*S)*T,t[10]=(d*w-y*x+m*g)*T,t[11]=(h*x-l*w-p*g)*T,t[12]=(s*k-a*I-u*S)*T,t[13]=(n*I-r*k+i*S)*T,t[14]=(y*b-d*P-v*g)*T,t[15]=(l*P-h*b+f*g)*T,t):null}function ot(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],f=e[9],p=e[10],d=e[11],y=e[12],v=e[13],m=e[14],g=e[15],b=n[0],x=n[1],P=n[2],w=n[3];return t[0]=b*r+x*s+P*h+w*y,t[1]=b*i+x*u+P*f+w*v,t[2]=b*o+x*c+P*p+w*m,t[3]=b*a+x*l+P*d+w*g,b=n[4],x=n[5],P=n[6],w=n[7],t[4]=b*r+x*s+P*h+w*y,t[5]=b*i+x*u+P*f+w*v,t[6]=b*o+x*c+P*p+w*m,t[7]=b*a+x*l+P*d+w*g,b=n[8],x=n[9],P=n[10],w=n[11],t[8]=b*r+x*s+P*h+w*y,t[9]=b*i+x*u+P*f+w*v,t[10]=b*o+x*c+P*p+w*m,t[11]=b*a+x*l+P*d+w*g,b=n[12],x=n[13],P=n[14],w=n[15],t[12]=b*r+x*s+P*h+w*y,t[13]=b*i+x*u+P*f+w*v,t[14]=b*o+x*c+P*p+w*m,t[15]=b*a+x*l+P*d+w*g,t}function at(t,e,n){var r,i,o,a,s,u,c,l,h,f,p,d,y=n[0],v=n[1],m=n[2];return e===t?(t[12]=e[0]*y+e[4]*v+e[8]*m+e[12],t[13]=e[1]*y+e[5]*v+e[9]*m+e[13],t[14]=e[2]*y+e[6]*v+e[10]*m+e[14],t[15]=e[3]*y+e[7]*v+e[11]*m+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],f=e[9],p=e[10],d=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=c,t[7]=l,t[8]=h,t[9]=f,t[10]=p,t[11]=d,t[12]=r*y+s*v+h*m+e[12],t[13]=i*y+u*v+f*m+e[13],t[14]=o*y+c*v+p*m+e[14],t[15]=a*y+l*v+d*m+e[15]),t}function st(){var t=new et(3);return et!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ut(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function ct(t,e,n){var r=new et(3);return r[0]=t,r[1]=e,r[2]=n,r}function lt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function ht(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function ft(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function pt(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function dt(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function yt(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function vt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var mt,gt=lt,bt=ht,xt=ft,Pt=pt,wt=dt,Et=ut,St=yt,kt=(mt=st(),function(t,e,n,r,i,o){var a,s;for(e||(e=3),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)mt[0]=t[a],mt[1]=t[a+1],mt[2]=t[a+2],i(mt,mt,o),t[a]=mt[0],t[a+1]=mt[1],t[a+2]=mt[2];return t}),Ot=Object.freeze({__proto__:null,create:st,clone:function(t){var e=new et(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},length:ut,fromValues:ct,copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},set:function(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},subtract:lt,multiply:ht,divide:ft,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},min:function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},max:function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},scale:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},scaleAndAdd:function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t},distance:pt,squaredDistance:dt,squaredLength:yt,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},normalize:function(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t},dot:vt,cross:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t},lerp:function(t,e,n,r){var i=e[0],o=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t},hermite:function(t,e,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,c=a*(o-1),l=a*(3-2*o);return t[0]=e[0]*s+n[0]*u+r[0]*c+i[0]*l,t[1]=e[1]*s+n[1]*u+r[1]*c+i[1]*l,t[2]=e[2]*s+n[2]*u+r[2]*c+i[2]*l,t},bezier:function(t,e,n,r,i,o){var a=1-o,s=a*a,u=o*o,c=s*a,l=3*o*s,h=3*u*a,f=u*o;return t[0]=e[0]*c+n[0]*l+r[0]*h+i[0]*f,t[1]=e[1]*c+n[1]*l+r[1]*h+i[1]*f,t[2]=e[2]*c+n[2]*l+r[2]*h+i[2]*f,t},random:function(t,e){e=e||1;var n=2*nt()*Math.PI,r=2*nt()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t},transformMat4:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t},transformMat3:function(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t},transformQuat:function(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],c=e[2],l=i*c-o*u,h=o*s-r*c,f=r*u-i*s,p=i*f-o*h,d=o*l-r*f,y=r*h-i*l,v=2*a;return l*=v,h*=v,f*=v,p*=2,d*=2,y*=2,t[0]=s+l+p,t[1]=u+h+d,t[2]=c+f+y,t},rotateX:function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},rotateY:function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},rotateZ:function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},angle:function(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),c=u&&vt(t,e)/u;return Math.acos(Math.min(Math.max(c,-1),1))},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t},str:function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},equals:function(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2];return Math.abs(n-o)<=tt*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=tt*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=tt*Math.max(1,Math.abs(i),Math.abs(s))},sub:gt,mul:bt,div:xt,dist:Pt,sqrDist:wt,len:Et,sqrLen:St,forEach:kt});function It(){var t=new et(4);return et!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Mt(t,e,n,r){var i=new et(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function _t(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function Tt(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function At(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Ct(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.hypot(n,r,i,o)}function Rt(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return n*n+r*r+i*i+o*o}function Nt(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function Ft(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function Dt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function jt(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}var Lt=_t,Bt=Tt,zt=At,Yt=Ct,Xt=Rt,Wt=Nt,Vt=Ft,Ut=function(){var t=It();return function(e,n,r,i,o,a){var s,u;for(n||(n=4),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),qt=Object.freeze({__proto__:null,create:It,clone:function(t){var e=new et(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},fromValues:Mt,copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},set:function(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},subtract:_t,multiply:Tt,divide:At,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},min:function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},max:function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},scale:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},scaleAndAdd:function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t},distance:Ct,squaredDistance:Rt,length:Nt,squaredLength:Ft,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},normalize:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=o*a,t},dot:Dt,cross:function(t,e,n,r){var i=n[0]*r[1]-n[1]*r[0],o=n[0]*r[2]-n[2]*r[0],a=n[0]*r[3]-n[3]*r[0],s=n[1]*r[2]-n[2]*r[1],u=n[1]*r[3]-n[3]*r[1],c=n[2]*r[3]-n[3]*r[2],l=e[0],h=e[1],f=e[2],p=e[3];return t[0]=h*c-f*u+p*s,t[1]=-l*c+f*a-p*o,t[2]=l*u-h*a+p*i,t[3]=-l*s+h*o-f*i,t},lerp:function(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t[3]=s+r*(n[3]-s),t},random:function(t,e){var n,r,i,o,a,s;e=e||1;do{a=(n=2*nt()-1)*n+(r=2*nt()-1)*r}while(a>=1);do{s=(i=2*nt()-1)*i+(o=2*nt()-1)*o}while(s>=1);var u=Math.sqrt((1-a)/s);return t[0]=e*n,t[1]=e*r,t[2]=e*i*u,t[3]=e*o*u,t},transformMat4:jt,transformQuat:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2],c=n[3],l=c*r+s*o-u*i,h=c*i+u*r-a*o,f=c*o+a*i-s*r,p=-a*r-s*i-u*o;return t[0]=l*c+p*-a+h*-u-f*-s,t[1]=h*c+p*-s+f*-a-l*-u,t[2]=f*c+p*-u+l*-s-h*-a,t[3]=e[3],t},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},str:function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},equals:function(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=e[0],s=e[1],u=e[2],c=e[3];return Math.abs(n-a)<=tt*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=tt*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=tt*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-c)<=tt*Math.max(1,Math.abs(o),Math.abs(c))},sub:Lt,mul:Bt,div:zt,dist:Yt,sqrDist:Xt,len:Wt,sqrLen:Vt,forEach:Ut});function Jt(t,e,n,r,i,o,a,s){var u=new et(8);return u[0]=t,u[1]=e,u[2]=n,u[3]=r,u[4]=i,u[5]=o,u[6]=a,u[7]=s,u}function Gt(){var t=new et(2);return et!=Float32Array&&(t[0]=0,t[1]=0),t}function Zt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Ht(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function Kt(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function $t(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function Qt(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function te(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function ee(t){var e=t[0],n=t[1];return e*e+n*n}var ne=te,re=Zt,ie=Ht,oe=Kt,ae=$t,se=Qt,ue=ee,ce=function(){var t=Gt();return function(e,n,r,i,o,a){var s,u;for(n||(n=2),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],o(t,t,a),e[s]=t[0],e[s+1]=t[1];return e}}(),le=Object.freeze({__proto__:null,create:Gt,clone:function(t){var e=new et(2);return e[0]=t[0],e[1]=t[1],e},fromValues:function(t,e){var n=new et(2);return n[0]=t,n[1]=e,n},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t},set:function(t,e,n){return t[0]=e,t[1]=n,t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},subtract:Zt,multiply:Ht,divide:Kt,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},min:function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},max:function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},scale:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},scaleAndAdd:function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t},distance:$t,squaredDistance:Qt,length:te,squaredLength:ee,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},normalize:function(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]},cross:function(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t},lerp:function(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t},random:function(t,e){e=e||1;var n=2*nt()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},transformMat2:function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t},transformMat2d:function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t},transformMat3:function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t},transformMat4:function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t},rotate:function(t,e,n,r){var i=e[0]-n[0],o=e[1]-n[1],a=Math.sin(r),s=Math.cos(r);return t[0]=i*s-o*a+n[0],t[1]=i*a+o*s+n[1],t},angle:function(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=Math.sqrt(n*n+r*r)*Math.sqrt(i*i+o*o),s=a&&(n*i+r*o)/a;return Math.acos(Math.min(Math.max(s,-1),1))},zero:function(t){return t[0]=0,t[1]=0,t},str:function(t){return"vec2("+t[0]+", "+t[1]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]},equals:function(t,e){var n=t[0],r=t[1],i=e[0],o=e[1];return Math.abs(n-i)<=tt*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=tt*Math.max(1,Math.abs(r),Math.abs(o))},len:ne,sub:re,mul:ie,div:oe,dist:ae,sqrDist:se,sqrLen:ue,forEach:ce});function he(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var fe=function(){function t(n,r,i,o){var a=this;if(e(this,t),isNaN(n))throw new Error("Invalid x found: ".concat(n));if(isNaN(r))throw new Error("Invalid y found: ".concat(r));var s=[n,r];isFinite(i)&&(s.push(i),isFinite(o)&&s.push(o)),this.value=s.toFloat32Array(),Object.defineProperty(this,"x",{get:function(){return a.value[0]},set:function(t){a.value[0]=t},enumerable:!0}),Object.defineProperty(this,"y",{get:function(){return a.value[1]},set:function(t){a.value[1]=t},enumerable:!0}),2==s.length?this.vec=le:3==s.length?(this.vec=Ot,Object.defineProperty(this,"z",{get:function(){return a.value[2]},set:function(t){a.value[2]=t},enumerable:!0})):(this.vec=qt,Object.defineProperty(this,"w",{get:function(){return a.value[3]},set:function(t){a.value[3]=t},enumerable:!0}))}return r(t,[{key:"add",value:function(e){e instanceof t||(e=t.fromPoint(e));var n=this.vec.create();return this.vec.add(n,this.value,e.value),t.fromPoint(n)}},{key:"addSelf",value:function(e){return e instanceof t||(e=t.fromPoint(e)),this.vec.add(this.value,this.value,e.value),this}},{key:"subtract",value:function(e){e instanceof t||(e=t.fromPoint(e));var n=this.vec.create();return this.vec.subtract(n,this.value,e.value),t.fromPoint(n)}},{key:"subtractSelf",value:function(e){return e instanceof t||(e=t.fromPoint(e)),this.vec.subtract(this.value,this.value,e.value),this}},{key:"multiply",value:function(e){e instanceof t||(e=t.fromPoint(e));var n=this.vec.create();return this.vec.multiply(n,this.value,e.value),t.fromPoint(n)}},{key:"multiplySelf",value:function(e){return e instanceof t||(e=t.fromPoint(e)),this.vec.multiply(this.value,this.value,e.value),this}},{key:"divide",value:function(e){e instanceof t||(e=t.fromPoint(e));var n=this.vec.create();return this.vec.divide(n,this.value,e.value),t.fromPoint(n)}},{key:"divideSelf",value:function(e){return e instanceof t||(e=t.fromPoint(e)),this.vec.divide(this.value,this.value,e.value),this}},{key:"scale",value:function(e){var n=this.vec.create();return this.vec.scale(n,this.value,e),t.fromPoint(n)}},{key:"scaleSelf",value:function(t){return this.vec.scale(this.value,this.value,t),this}},{key:"abs",value:function(){return new t(Math.abs(this.x),Math.abs(this.y),isFinite(this.z)?Math.abs(this.z):void 0,isFinite(this.w)?Math.abs(this.w):void 0)}},{key:"absSelf",value:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),isFinite(this.z)&&(this.z=Math.abs(this.z)),isFinite(this.w)&&(this.w=Math.abs(this.w)),this}},{key:"transform",value:function(e){if(!e)return this;var n=this.vec.create();return this.vec.transformMat4(n,this.value,e.toFloat32Array()),t.fromPoint(n)}},{key:"transformSelf",value:function(t){return this.vec.transformMat4(this.value,this.value,t.toFloat32Array()),this}},{key:"toFloat32Array",value:function(){return this.value}},{key:"toJSON",value:function(){var t={x:this.x,y:this.y};return isFinite(this.z)&&(t.z=this.z,isFinite(this.w)&&(t.w=this.w)),t}},{key:"toString",value:function(){return"point(".concat(this.value.join(", "),")")}},{key:"clone",value:function(){return t.fromPoint(this)}}],[{key:"fromPoint",value:function(e){return Array.isArray(e)||ArrayBuffer.isTypedArray(e)?new t(e[0],e[1],e[2],e[3]):new t(e.x,e.y,e.z,e.w)}}]),t}(),pe={m11:0,m12:1,m13:2,m14:3,m21:4,m22:5,m23:6,m24:7,m31:8,m32:9,m33:10,m34:11,m41:12,m42:13,m43:14,m44:15},de=pe.m11,ye=pe.m12,ve=pe.m21,me=pe.m22,ge=pe.m41,be=pe.m42,xe=function(){function t(){var n=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:rt(),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.MultiplicationType.PRE;e(this,t),Object.defineProperty(this,"value",{value:r,enumerable:!0}),Object.defineProperty(this,"multiplicationType",{value:i,enumerable:!0});var o=function(t,e){var n=pe[t];this.value[n]=e};Object.defineProperty(this,"a",{get:function(){return n.value[de]},set:o.bind(this,"m11"),enumerable:!0}),Object.defineProperty(this,"b",{get:function(){return n.value[ye]},set:o.bind(this,"m12"),enumerable:!0}),Object.defineProperty(this,"c",{get:function(){return n.value[ve]},set:o.bind(this,"m21"),enumerable:!0}),Object.defineProperty(this,"d",{get:function(){return n.value[me]},set:o.bind(this,"m22"),enumerable:!0}),Object.defineProperty(this,"e",{get:function(){return n.value[ge]},set:o.bind(this,"m41"),enumerable:!0}),Object.defineProperty(this,"f",{get:function(){return n.value[be]},set:o.bind(this,"m42"),enumerable:!0}),Object.defineProperty(this,"tx",{get:function(){return n.value[ge]},set:o.bind(this,"m41"),enumerable:!0}),Object.defineProperty(this,"ty",{get:function(){return n.value[be]},set:o.bind(this,"m42"),enumerable:!0}),Object.defineProperty(this,"m11",{get:function(){return n.value[0]},set:o.bind(this,"m11"),enumerable:!0}),Object.defineProperty(this,"m12",{get:function(){return n.value[1]},set:o.bind(this,"m12"),enumerable:!0}),Object.defineProperty(this,"m13",{get:function(){return n.value[2]},set:o.bind(this,"m13"),enumerable:!0}),Object.defineProperty(this,"m14",{get:function(){return n.value[3]},set:o.bind(this,"m14"),enumerable:!0}),Object.defineProperty(this,"m21",{get:function(){return n.value[4]},set:o.bind(this,"m21"),enumerable:!0}),Object.defineProperty(this,"m22",{get:function(){return n.value[5]},set:o.bind(this,"m22"),enumerable:!0}),Object.defineProperty(this,"m23",{get:function(){return n.value[6]},set:o.bind(this,"m23"),enumerable:!0}),Object.defineProperty(this,"m24",{get:function(){return n.value[7]},set:o.bind(this,"m24"),enumerable:!0}),Object.defineProperty(this,"m31",{get:function(){return n.value[8]},set:o.bind(this,"m31"),enumerable:!0}),Object.defineProperty(this,"m32",{get:function(){return n.value[9]},set:o.bind(this,"m32"),enumerable:!0}),Object.defineProperty(this,"m33",{get:function(){return n.value[10]},set:o.bind(this,"m33"),enumerable:!0}),Object.defineProperty(this,"m34",{get:function(){return n.value[11]},set:o.bind(this,"m34"),enumerable:!0}),Object.defineProperty(this,"m41",{get:function(){return n.value[12]},set:o.bind(this,"m41"),enumerable:!0}),Object.defineProperty(this,"m42",{get:function(){return n.value[13]},set:o.bind(this,"m42"),enumerable:!0}),Object.defineProperty(this,"m43",{get:function(){return n.value[14]},set:o.bind(this,"m43"),enumerable:!0}),Object.defineProperty(this,"m44",{get:function(){return n.value[15]},set:o.bind(this,"m44"),enumerable:!0}),Object.defineProperty(this,"isIdentity",{get:function(){return 1==n.a&&0==n.b&&0==n.c&&1==n.d&&0==n.tx&&0==n.ty},enumerable:!0}),Object.defineProperty(this,"is2D",{get:function(){return!(0!=n.m31||0!=n.m32||0!=n.m13||0!=n.m23||1!=n.m33||0!=n.m43||0!=n.m14||0!=n.m24||0!=n.m34||1!=n.m44)},enumerable:!0}),Object.defineProperty(this,"translateX",{get:function(){return n.tx}}),Object.defineProperty(this,"translateY",{get:function(){return n.ty}}),Object.defineProperty(this,"skewX",{get:function(){return Math.tan(n.c)}}),Object.defineProperty(this,"skewY",{get:function(){return Math.tan(n.b)}}),Object.defineProperty(this,"scaleX",{get:function(){return Math.sqrt(n.a*n.a+n.c*n.c)}}),Object.defineProperty(this,"scaleY",{get:function(){return Math.sqrt(n.d*n.d+n.b*n.b)}}),Object.defineProperty(this,"rotation",{get:function(){return Math.atan2(n.b,n.a)}})}return r(t,[{key:"clone",value:function(){return new t(this.value.clone(),this.multiplicationType)}},{key:"translate",value:function(e){return this.multiply(t.fromTranslate(e))}},{key:"translateSelf",value:function(e){this.multiplySelf(t.fromTranslate(e))}},{key:"rotate",value:function(e,n){return this.multiply(t.fromRotate(e,n))}},{key:"rotateSelf",value:function(e,n){this.multiplySelf(t.fromRotate(e,n))}},{key:"scale",value:function(e,n){return this.multiply(t.fromScale(e,n))}},{key:"scaleSelf",value:function(e,n){this.multiplySelf(t.fromScale(e,n))}},{key:"multiply",value:function(e){return this.multiplicationType==t.MultiplicationType.PRE?this.preMultiply(e):this.postMultiply(e)}},{key:"preMultiply",value:function(e){var n=rt();return ot(n,e.toFloat32Array(),this.value),new t(n,this.multiplicationType)}},{key:"postMultiply",value:function(e){var n=rt();return ot(n,this.value,e.toFloat32Array()),new t(n,this.multiplicationType)}},{key:"multiplySelf",value:function(e){this.multiplicationType==t.MultiplicationType.PRE?this.preMultiplySelf(e):this.postMultiplySelf(e)}},{key:"preMultiplySelf",value:function(t){ot(this.value,t.toFloat32Array(),this.value)}},{key:"postMultiplySelf",value:function(t){ot(this.value,this.value,t.toFloat32Array())}},{key:"invert",value:function(){var e=rt();return it(e,this.value),new t(e,this.multiplicationType)}},{key:"invertSelf",value:function(){it(this.value,this.value)}},{key:"decompose",value:function(){return{translate:{x:this.tx,y:this.ty},rotate:{angle:Math.atan2(this.b,this.a)},skew:{angleX:Math.tan(this.c),angleY:Math.tan(this.b)},scale:{x:Math.sqrt(this.a*this.a+this.c*this.c),y:Math.sqrt(this.d*this.d+this.b*this.b)},matrix:this.toJSON()}}},{key:"transformPoint",value:function(t){return fe.fromPoint(t).transform(this)}},{key:"toFloat32Array",value:function(){return this.value}},{key:"toJSON",value:function(){return{a:this.a,b:this.b,c:this.c,d:this.d,tx:this.tx,ty:this.ty}}},{key:"toString",value:function(t){if(t){var e=function(t){return((t<0?"":" ")+t.toPrecision(6)).substring(0,8)};return" Matrix 4x4\n"+"-".repeat(39)+"\n".concat(e(this.m11),", ").concat(e(this.m21),", ").concat(e(this.m31),", ").concat(e(this.m41))+"\n".concat(e(this.m12),", ").concat(e(this.m22),", ").concat(e(this.m32),", ").concat(e(this.m42))+"\n".concat(e(this.m13),", ").concat(e(this.m23),", ").concat(e(this.m33),", ").concat(e(this.m43))+"\n".concat(e(this.m14),", ").concat(e(this.m24),", ").concat(e(this.m34),", ").concat(e(this.m44))}return this.is2D?"matrix(".concat(this.a,", ").concat(this.b,", ").concat(this.c,", ").concat(this.d,", ").concat(this.tx,", ").concat(this.ty,")"):"matrix3d(".concat(this.m11,", ").concat(this.m12,", ").concat(this.m13,", ").concat(this.m14,", ").concat(this.m21,", ").concat(this.m22,", ").concat(this.m23,", ").concat(this.m24,", ").concat(this.m31,", ").concat(this.m32,", ").concat(this.m33,", ").concat(this.m34,", ").concat(this.m41,", ").concat(this.m42,", ").concat(this.m43,", ").concat(this.m44,")")}}],[{key:"fromString",value:function(e,n){var r=rt();if("none"!=e){var i=e.substring(0,e.indexOf("("));e=e.substring(e.indexOf("(")+1,e.indexOf(")")).split(/,\s*/g),"matrix3d"==i?(r[0]=parseFloat(e[0]),r[1]=parseFloat(e[1]),r[2]=parseFloat(e[2]),r[3]=parseFloat(e[3]),r[4]=parseFloat(e[4]),r[5]=parseFloat(e[5]),r[6]=parseFloat(e[6]),r[7]=parseFloat(e[7]),r[8]=parseFloat(e[8]),r[9]=parseFloat(e[9]),r[10]=parseFloat(e[10]),r[11]=parseFloat(e[11]),r[12]=parseFloat(e[12]),r[13]=parseFloat(e[13]),r[14]=parseFloat(e[14]),r[15]=parseFloat(e[15])):(r[de]=parseFloat(e[0]),r[ye]=parseFloat(e[1]),r[ve]=parseFloat(e[2]),r[me]=parseFloat(e[3]),r[ge]=parseFloat(e[4]),r[be]=parseFloat(e[5]))}return new t(r,n)}},{key:"fromMatrix",value:function(e,n){if(!e)throw new Error("data not found, Matrix instance creation failed");if("function"==typeof e)throw new Error("data type function is not allowed");if(e instanceof t)return e;if(Array.isArray(e)&&(e=new Float32Array(e)),e instanceof Float32Array)return new t(e,n);if("string"==typeof e)return t.fromString(e,n);var r=rt(),i=Object.assign({},e);return isFinite(e.a)&&(i.m11=e.a),isFinite(e.b)&&(i.m12=e.b),isFinite(e.c)&&(i.m21=e.c),isFinite(e.d)&&(i.m22=e.d),isFinite(e.tx)?i.m41=e.tx:isFinite(e.e)?i.m41=e.e:isFinite(e.dx)&&(i.m41=e.dx),isFinite(e.ty)?i.m42=e.ty:isFinite(e.f)?i.m42=e.f:isFinite(e.dy)&&(i.m42=e.dy),isFinite(i.m11)&&(r[0]=i.m11),isFinite(i.m12)&&(r[1]=i.m12),isFinite(i.m13)&&(r[2]=i.m13),isFinite(i.m14)&&(r[3]=i.m14),isFinite(i.m21)&&(r[4]=i.m21),isFinite(i.m22)&&(r[5]=i.m22),isFinite(i.m23)&&(r[6]=i.m23),isFinite(i.m24)&&(r[7]=i.m24),isFinite(i.m31)&&(r[8]=i.m31),isFinite(i.m32)&&(r[9]=i.m32),isFinite(i.m33)&&(r[10]=i.m33),isFinite(i.m34)&&(r[11]=i.m34),isFinite(i.m41)&&(r[12]=i.m41),isFinite(i.m42)&&(r[13]=i.m42),isFinite(i.m43)&&(r[14]=i.m43),isFinite(i.m44)&&(r[15]=i.m44),new t(r,n||e.multiplicationType)}},{key:"fromTranslate",value:function(e){var n=isFinite(e)?{tx:e,ty:e}:{tx:e.x,ty:e.y};return t.fromMatrix(n)}},{key:"fromRotate",value:function(e,n){var r=Math.sin(e),i=Math.cos(e),o={a:i,b:r,c:-r,d:i};return n&&(o.tx=n.x-n.x*i+n.y*r,o.ty=n.y-n.x*r-n.y*i),t.fromMatrix(o)}},{key:"fromScale",value:function(e,n){isFinite(e)&&(e={x:e,y:e});var r={a:e.x,d:e.y};return n&&(r.tx=n.x-n.x*e.x,r.ty=n.y-n.y*e.y),t.fromMatrix(r)}},{key:"fromPoints",value:function(e,n){if(!Array.isArray(e)||!Array.isArray(n))throw new Error("Expected input type Array requirement not satisfied");if(3!=e.length||3!=n.length)throw new Error("Expected input size 3 requirement not satisfied");var r=t.fromMatrix({m11:e[0].x,m21:e[1].x,m31:e[2].x,m12:e[0].y,m22:e[1].y,m32:e[2].y,m13:1,m23:1,m33:1}),i=t.fromMatrix({m11:n[0].x,m21:n[1].x,m31:n[2].x,m12:n[0].y,m22:n[1].y,m32:n[2].y,m13:1,m23:1,m33:1}),o=r.invert().preMultiply(i);return t.fromMatrix({a:o.m11,b:o.m12,c:o.m21,d:o.m22,tx:o.m31,ty:o.m32})}},{key:"multiply",value:function(e,n){var r=rt();return ot(r,e.value,n.value),new t(r)}}]),t}();function Pe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=c(t);if(e){var i=c(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u(this,n)}}xe.MultiplicationType=Object.freeze({PRE:"PRE",POST:"POST"});var we=function(t){o(i,t);var n=Pe(i);function i(t,r,o){var a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return e(this,i),(a=n.call(this,t,r,o)).red=s.red,a.green=s.green,a.blue=s.blue,a.alpha=s.alpha,a.size=s.size||i.defaults.size,a.rotation=s.rotation||i.defaults.rotation,a.scaleX=s.scaleX||i.defaults.scaleX,a.scaleY=s.scaleY||i.defaults.scaleY,a.scaleZ=isFinite(o)?s.scaleZ||i.defaults.scaleZ:void 0,a.offsetX=s.offsetX||i.defaults.offsetX,a.offsetY=s.offsetY||i.defaults.offsetY,a.offsetZ=isFinite(o)?s.offsetZ||i.defaults.offsetZ:void 0,a.dX,a.dY,a}return r(i,[{key:"fill",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o={},a=t*n.length;n.forEach((function(t,n){return i.setProperty(o,t,e[a+n])})),this.x=o.x,this.y=o.y,this.z=o.z,this.red=isFinite(o.red)?o.red:r.red,this.green=isFinite(o.green)?o.green:r.green,this.blue=isFinite(o.blue)?o.blue:r.blue,this.alpha=isFinite(o.alpha)?o.alpha:r.alpha,this.size=o.size||r.size||i.defaults.size,this.rotation=o.rotation||r.rotation||i.defaults.rotation,this.scaleX=o.scaleX||r.scaleX||i.defaults.scaleX,this.scaleY=o.scaleY||r.scaleY||i.defaults.scaleY,this.scaleZ=isFinite(o.z)?o.scaleZ||r.scaleZ||i.defaults.scaleZ:void 0,this.offsetX=o.offsetX||r.offsetX||i.defaults.offsetX,this.offsetY=o.offsetY||r.offsetY||i.defaults.offsetY,this.offsetZ=isFinite(o.z)?o.offsetZ||r.offsetZ||i.defaults.offsetZ:void 0,this.dX=o.dX,this.dY=o.dY}},{key:"getProperty",value:function(t){switch(t){case i.Property.X:return this.x;case i.Property.Y:return this.y;case i.Property.Z:return this.z;case i.Property.RED:return this.red;case i.Property.GREEN:return this.green;case i.Property.BLUE:return this.blue;case i.Property.ALPHA:return this.alpha;case i.Property.SIZE:return this.size;case i.Property.ROTATION:return this.rotation;case i.Property.SCALE_X:return this.scaleX;case i.Property.SCALE_Y:return this.scaleY;case i.Property.SCALE_Z:return this.scaleZ;case i.Property.OFFSET_X:return this.offsetX;case i.Property.OFFSET_Y:return this.offsetY;case i.Property.OFFSET_Z:return this.offsetZ;case i.Property.D_X:return this.dX;case i.Property.D_Y:return this.dY;default:throw console.warn(t),new Error("Invalid property found")}}},{key:"setProperty",value:function(t,e){i.setProperty(this,t,e)}},{key:"transform",value:function(t){if(!(t instanceof xe))throw new Error("matrix is instance of ".concat(t.constructor.name," - it should be instance of Matrix. Use Matrix.fromMatrix method to convert."));var e=t.scaleX,n=t.rotation;this.transformSelf(t),this.size*=e,this.rotation+=n,this.scaleX*=e,this.scaleY*=e,isFinite(this.z)&&(this.scaleZ*=e),this.offsetX*=e,this.offsetY*=e,isFinite(this.z)&&(this.offsetZ*=e)}},{key:"toArray",value:function(t){var e=this;return t.map((function(t){var n=e.getProperty(t);if(null==n||isNaN(n))throw new Error("Property ".concat(t.name," has invalid value ").concat(n));return n}))}},{key:"toJSON",value:function(){var t=this,e={};return i.Property.values.forEach((function(n){var r=t.getProperty(n);null!=r&&isFinite(r)&&(e[n.name]=t.getProperty(n))})),e}}],[{key:"createInstance",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=new i(0,0,t.includes(i.Property.Z)?0:void 0);return n&&o.fill(r,n,t,e),o}},{key:"setProperty",value:function(t,e,n){switch(e){case i.Property.X:t.x=n;break;case i.Property.Y:t.y=n;break;case i.Property.Z:t.z=n;break;case i.Property.RED:t.red=n;break;case i.Property.GREEN:t.green=n;break;case i.Property.BLUE:t.blue=n;break;case i.Property.ALPHA:t.alpha=n;break;case i.Property.SIZE:t.size=n;break;case i.Property.ROTATION:t.rotation=n;break;case i.Property.SCALE_X:t.scaleX=n;break;case i.Property.SCALE_Y:t.scaleY=n;break;case i.Property.SCALE_Z:t.scaleZ=n;break;case i.Property.OFFSET_X:t.offsetX=n;break;case i.Property.OFFSET_Y:t.offsetY=n;break;case i.Property.OFFSET_Z:t.offsetZ=n;break;case i.Property.D_X:t.dX=n;break;case i.Property.D_Y:t.dY=n;break;default:throw console.warn(e),new Error("Invalid property found")}}}]),i}(fe);he(we,"defaults",{size:1,rotation:0,scaleX:1,scaleY:1,scaleZ:1,offsetX:0,offsetY:0,offsetZ:0}),Object.defineEnum(we,"Property",["X","Y","Z","RED","GREEN","BLUE","ALPHA","SIZE","ROTATION","SCALE_X","SCALE_Y","SCALE_Z","OFFSET_X","OFFSET_Y","OFFSET_Z","D_X","D_Y"]);var Ee=function(){function t(n,r,i){var o=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(e(this,t),this.red=n,this.green=r,this.blue=i,this.alpha=a,a<0||a>1)throw new Error("Invalid alpha ".concat(a," found. The value must be in the interval [0, 1]."));Object.defineProperty(this,"hex",{get:function(){return"#".concat(o.red.toString(16).pad(2,"0")).concat(o.green.toString(16).pad(2,"0")).concat(o.blue.toString(16).pad(2,"0")).concat(Math.round(255*o.alpha).toString(16).pad(2,"0"))},enumerable:!0})}return r(t,[{key:"premultiply",value:function(){return{red:this.red/255*this.alpha,green:this.green/255*this.alpha,blue:this.blue/255*this.alpha,alpha:this.alpha}}},{key:"equals",value:function(t){return t&&this.red==t.red&&this.green==t.green&&this.blue==t.blue&&this.alpha==t.alpha}},{key:"toRGB",value:function(){return 1==this.alpha?this:new t(this.red,this.green,this.blue)}},{key:"toRGBA",value:function(e){return new t(this.red,this.green,this.blue,e)}},{key:"toHSLA",value:function(){var t=this.red/255,e=this.green/255,n=this.blue/255,r=Math.min(t,e,n),i=Math.max(t,e,n),o=0,a=0,s=(i+r)/2;if(i!=r){var u=i-r;switch(a=u/(1-Math.abs(2*s-1)),i){case t:o=(e-n)/u%6;break;case e:o=(n-t)/u+2;break;case n:o=(t-e)/u+4}}return(o*=60)<0&&(o+=360),{hue:parseFloat(o.toFixed(0)),saturation:parseFloat((100*a).toFixed(2)),lightness:parseFloat((100*s).toFixed(2)),alpha:this.alpha}}},{key:"toArray",value:function(){return[this.red,this.green,this.blue,this.alpha]}},{key:"toJSON",value:function(){return{red:this.red,green:this.green,blue:this.blue,alpha:this.alpha}}},{key:"toString",value:function(){return 1==this.alpha?"rgb(".concat(this.red,", ").concat(this.green,", ").concat(this.blue,")"):"rgba(".concat(this.red,", ").concat(this.green,", ").concat(this.blue,", ").concat(this.alpha,")")}}],[{key:"postdivide",value:function(e,n,r,i){return new t(parseInt(255*e/i),parseInt(255*n/i),parseInt(255*r/i),i)}},{key:"isColor",value:function(t){return t&&isFinite(t.red)&&isFinite(t.green)&&isFinite(t.blue)}},{key:"fromColor",value:function(e){var n,r,i,o;if("string"==typeof e)if(e.startsWith("rgb"))e=e.substring(e.indexOf("(")+1,e.indexOf(")")).split(/,\s*/g),n=parseInt(e[0]),r=parseInt(e[1]),i=parseInt(e[2]),o=e[3]?parseInt(e[3]):1;else{if(!e.startsWith("#"))throw new Error("Unknown input found: ".concat(e,". Expected data starts with rgba, rgb or #."));e=e.substring(1),n=parseInt(e.substring(0,2),16),r=parseInt(e.substring(2,4),16),i=parseInt(e.substring(4,6),16),o=8==e.length?parseInt(e.substring(6,8),16)/255:1}else Array.isArray(e)?(n=e[0],r=e[1],i=e[2],o=e[3]):(n=e.red,r=e.green,i=e.blue,o=e.alpha);return new t(n,r,i,o)}},{key:"fromHSLA",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;e/=60,n/=100,r/=100;var o=(1-Math.abs(2*r-1))*n,a=o*(1-Math.abs(e%2-1)),s=0,u=0,c=0;e>=0&&e<1?(s=o,u=a):e>=1&&e<2?(s=a,u=o):e>=2&&e<3?(u=o,c=a):e>=3&&e<4?(u=a,c=o):e>=4&&e<5?(s=a,c=o):(s=o,c=a);var l=r-o/2;return s+=l,u+=l,c+=l,new t(Math.round(255*s),Math.round(255*u),Math.round(255*c),i)}},{key:"random",value:function(e){return new t(Math.randomInt(0,255),Math.randomInt(0,255),Math.randomInt(0,255),e?Math.random():1)}}]),t}();function Se(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ke(t){return function(t){if(Array.isArray(t))return Se(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Se(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Se(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}Ee.TRANSPERENT=new Ee(0,0,0,0),Ee.BLACK=new Ee(0,0,0,1),Ee.WHITE=new Ee(255,255,255,1),Ee.RED=new Ee(255,0,0,1),Ee.GREEN=new Ee(0,255,0,1),Ee.BLUE=new Ee(0,0,255,1);var Oe={longToByteArray:function(t){for(var e=[0,0,0,0,0,0,0,0],n=0;n<e.length;n++){var r=255&t;e[n]=r,t=(t-r)/256}return e},byteArrayToLong:function(t){for(var e=0,n=t.length-1;n>=0;n--)e=256*e+t[n];return e},crc32:function(){for(var t=new Uint32Array(256),e=256;e--;){for(var n=e,r=8;r--;)n=1&n?3988292384^n>>>1:n>>>1;t[e]=n}return function(e){for(var n=-1,r=0,i=e.length;r<i;r++)n=n>>>8^t[255&n^e[r]];return(-1^n)>>>0}}(),encodeBitMask:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(0==t.length)return 0;for(var e="",n=Math.max.apply(Math,ke(t)),r=1;r<=n;r++)e+=t.includes(r)?"1":"0";return parseInt(e.split("").reverse().join(""),2)},decodeBitMask:function(t){for(var e=[],n=t.toString(2).split("").reverse(),r=0;r<n.length;r++)1==n[r]&&e.push(r+1);return e},mapTo:function(t,e,n){return n.min+(Oe.clamp(t,e)-e.min)/(e.max-e.min)*(n.max-n.min)},clamp:function(t,e){return Math.min(Math.max(t,e.min),e.max)},debounce:function(t,e){var n=null;return function(){var r=this,i=arguments;clearTimeout(n),n=setTimeout((function(){t.apply(r,i)}),e)}},comparator:function(){var t=Array.prototype.slice.call(arguments),e=function(t,e,n){var r="asc"===n?1:-1;return t>e?1*r:t<e?-1*r:0},n=function(t,e,n){return e.replace("[",".").replace("]","").split(".").forEach((function(e){return t=t[e]})),n?t.toLowerCase():t};return function(r,i){return t.map((function(t){return e(n(r,t.sortBy,t.ignoreCase),n(i,t.sortBy,t.ignoreCase),t.sortOrder)})).reduceRight((function(t,e){return e||t}))}},isValidURL:function(t){if("string"!=typeof t)return!1;try{return new URL(t),!0}catch(t){return!1}},getPropName:function(t,e){var n=t.split("_"),r=n.first.toLowerCase();e&&(r=r.substring(0,1).toUpperCase()+r.substring(1));for(var i=1;i<n.length;i++)r+=n[i].substring(0,1),r+=n[i].substring(1).toLowerCase();return r},getEnumValueName:function(t){for(var e="",n=0;n<t.length;n++)n>0&&t[n]!=t[n].toLowerCase()&&(e+="_"),e+=t[n];return e.toUpperCase()}},Ie=function(){function t(n,r){var i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e(this,t),this.layout=n,this.pointProps=r,this.sheet={};var a={};Object.defineProperties(a,{size:{get:this.getComputed.bind(this,"size"),set:this.setStyle.bind(this,"size"),enumerable:!0},red:{get:this.getComputed.bind(this,"red"),set:this.setStyle.bind(this,"red"),enumerable:!0},green:{get:this.getComputed.bind(this,"green"),set:this.setStyle.bind(this,"green"),enumerable:!0},blue:{get:this.getComputed.bind(this,"blue"),set:this.setStyle.bind(this,"blue"),enumerable:!0},alpha:{get:this.getComputed.bind(this,"alpha"),set:this.setStyle.bind(this,"alpha"),enumerable:!0},rotation:{get:this.getComputed.bind(this,"rotation"),set:this.setStyle.bind(this,"rotation"),enumerable:!0},scaleX:{get:this.getComputed.bind(this,"scaleX"),set:this.setStyle.bind(this,"scaleX"),enumerable:!0},scaleY:{get:this.getComputed.bind(this,"scaleY"),set:this.setStyle.bind(this,"scaleY"),enumerable:!0},scaleZ:{get:this.getComputed.bind(this,"scaleZ"),set:this.setStyle.bind(this,"scaleZ"),enumerable:!0},offsetX:{get:this.getComputed.bind(this,"offsetX"),set:this.setStyle.bind(this,"offsetX"),enumerable:!0},offsetY:{get:this.getComputed.bind(this,"offsetY"),set:this.setStyle.bind(this,"offsetY"),enumerable:!0},offsetZ:{get:this.getComputed.bind(this,"offsetZ"),set:this.setStyle.bind(this,"offsetZ"),enumerable:!0},color:{get:this.getComputed.bind(this,"color"),set:this.setStyle.bind(this,"color"),enumerable:!0},blendMode:{get:this.getComputed.bind(this,"blendMode"),set:this.setStyle.bind(this,"blendMode"),enumerable:!0},visibility:{get:this.getComputed.bind(this,"visibility"),set:this.setStyle.bind(this,"visibility"),enumerable:!0},reset:{value:function(t){t&&(o=t),i.clear(),Object.keys(o).forEach((function(t){return i.setStyle(t,o[t])}))}},clear:{value:this.clear.bind(this)}}),this.style=Object.freeze(a),this.style.reset(o)}return r(t,[{key:"setStyle",value:function(e,n){if(null==n&&(n=void 0),t.validate(this.layout,e,n),"color"==e&&n)return this.sheet.red=n.red,this.sheet.green=n.green,this.sheet.blue=n.blue,void(this.sheet.alpha=n.alpha);null==n?delete this.sheet[e]:this.sheet[e]=n}},{key:"getStyle",value:function(t){var e=this.sheet[t];return"visibility"==t?"boolean"!=typeof e&&(e=!0):"color"==t&&Ee.isColor(this.sheet)&&(e=Ee.fromColor(this.sheet)),e}},{key:"getComputed",value:function(t){var e=this.getStyle(t);if(null==e)if("color"==t){var n={red:isFinite(this.sheet.red)?this.sheet.red:this.pointProps.red,green:isFinite(this.sheet.green)?this.sheet.green:this.pointProps.green,blue:isFinite(this.sheet.blue)?this.sheet.blue:this.pointProps.blue,alpha:isFinite(this.sheet.alpha)?this.sheet.alpha:this.pointProps.alpha};Ee.isColor(n)&&(e=Ee.fromColor(n))}else e=this.pointProps[t];return e}},{key:"clear",value:function(){this.sheet={}}}],[{key:"validate",value:function(t,e,n,r){var i;if(n&&t.includes(we.Property[Oe.getEnumValueName(e)])){if(!r)throw new Error("Property ".concat(e," value ").concat(n," is not applicable. This is a dynamic property and is part of the layout."));console.warn("Property ".concat(e," value ").concat(n," is not applicable. This is a dynamic property and is part of the layout.")),n=void 0}if("color"==e)!n||n instanceof Ee||(i="Property ".concat(e," is not an instance of Color"));else if("blendMode"==e)""==n&&(n=void 0);else if("number"==typeof n)if("size"==e)n<0?i="Property ".concat(e," with value ").concat(n," is not allowed. Value should be a positive number."):0==n&&(n=void 0);else if("red"==e||"green"==e||"blue"==e||"alpha"==e){var o="alpha"==e?{min:0,max:1}:{min:0,max:255};n>=o.min&&n<=o.max||(i="Property ".concat(e," with value ").concat(n," is out of range. Allowd range: [").concat(o.min,", ").concat(o.max,"]."))}else"rotation"==e?0==n&&(n=void 0):"scattering"==e&&n<0&&(n=void 0);if(i)throw new Error(i);return n}}]),t}(),Me=[we.Property.X,we.Property.Y],_e=function(){function t(n){var r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Me;if(e(this,t),t.name==this.constructor.name)throw new Error("Path class is abstract. Constructor is not accessible.");if(n%o.length!=0)throw new Error("Points length do not matches with given layout");if(Object.defineProperties(this,{layout:{value:Object.freeze(o)},stride:{value:o.length},length:{value:n/o.length}}),!Object.isSealed(i))for(var a in i)void 0!==i[a]&&(i[a]=Ie.validate(this.layout,a,i[a],!0));o.includes(we.Property.ROTATION)||"rotation"in i||(i.rotation=void 0),o.includes(we.Property.SIZE)||i.size||(i.size=1),Object.defineProperty(this,"pointProps",{value:Object.seal(i)}),o.forEach((function(t,e){var n=Oe.getPropName(t.name,!0);Object.defineProperty(r,"setPoint".concat(n),{value:r.setPointPropertyValue.bind(r,e)}),Object.defineProperty(r,"getPoint".concat(n),{value:r.getPointPropertyValue.bind(r,e)})}))}return r(t,[{key:"setPointPropertyValue",value:function(t,e,n){if(isNaN(e))throw new Error("Point index is required");if(e>=this.length||e<0)throw new Error("Index ".concat(t," out of range - (0, ").concat(this.length-1,")"));if(isNaN(n))throw new Error("value is required");this.points[e*this.layout.length+t]=n}},{key:"getPointPropertyValue",value:function(t,e){if(isNaN(e))throw new Error("Point index is required");if(e>=this.length||e<0)throw new Error("Index ".concat(t," out of range - (0, ").concat(this.length-1,")"));return this.points[e*this.layout.length+t]}},{key:"setPoint",value:function(t,e){var n=this,r=t*this.stride;this.layout.forEach((function(t,i){return n.points[r+i]=e.getProperty(t)}))}},{key:"getPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.pointProps;if(t>=this.length||t<0)throw new Error("Index ".concat(t," out of range - (0, ").concat(this.length-1,")"));return we.createInstance(this.layout,e,this.points,t)}},{key:"getChannelData",value:function(t){var e=new([we.Property.RED,we.Property.GREEN,we.Property.BLUE].includes(t)?Uint8Array:Float32Array)(this.length),n=this.layout.indexOf(t);if(-1==n)throw new Error("Property ".concat(t.name," is not part from the spline layout ").concat(this.layout.map((function(t){return t.name})).join(", ")));for(var r=0;r<this.length;r++)e[r]=this.points[r*this.stride+n];return e}},{key:"transform",value:function(t){for(var e=t.scaleX,n=t.rotation,r=0;r<this.length;r++){var i=r*this.stride,o=Mt(this.getPointX(r),this.getPointY(r),0,1);jt(o,o,t.value);for(var a=0;a<this.stride;a++){var s=i+a;switch(this.layout[a]){case we.Property.X:this.points[s]=o[0]/o[3];break;case we.Property.Y:this.points[s]=o[1]/o[3];break;case we.Property.Z:this.points[s]=o[2]/o[3];break;case we.Property.ROTATION:this.points[s]+=n;break;case we.Property.SIZE:case we.Property.SCALE_X:case we.Property.SCALE_Y:case we.Property.SCALE_Z:case we.Property.OFFSET_X:case we.Property.OFFSET_Y:case we.Property.OFFSET_Z:this.points[s]*=e}}}this.layout.includes(we.Property.ROTATION)||(this.pointProps.rotation=0==n?void 0:n)}},{key:"clone",value:function(){throw new Error("Path.clone()) is abstract and should be implemented")}},{key:"slice",value:function(t){throw new Error("Path.slice(fragment)) is abstract and should be implemented")}},{key:"slicePoints",value:function(t,e){throw new Error("Path.slicePoints(fromPointIndex, toPointIndex, fromTValue, toTValue)) is abstract and should be implemented")}},{key:"toSVGPath",value:function(){for(var t=[],e=0;e<this.length;e++)t.push("".concat(this.getPointX(e),",").concat(this.getPointY(e)));return"M ".concat(t.join(" L ")," Z")}},{key:"toJSON",value:function(){throw new Error("Path.toJSON() is abstract and should be implemented")}}],[{key:"fromJSON",value:function(t){throw new Error("static Path.fromJSON(data) is abstract and should be implemented")}},{key:"fromRect",value:function(t,e){return new this([t.left,t.top,t.right,t.top,t.right,t.bottom,t.left,t.bottom,t.left,t.top],e)}}]),t}(),Te=function(){function t(n,r,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;e(this,t),Object.defineProperties(this,{path:{value:n,enumerable:!0},fromPointIndex:{value:r,enumerable:!0},toPointIndex:{value:i,enumerable:!0},fromTValue:{value:o,enumerable:!0},toTValue:{value:a,enumerable:!0}}),this.validate()}return r(t,[{key:"validate",value:function(){t.validate(this.path,this.fromPointIndex,this.toPointIndex,this.fromTValue,this.toTValue)}},{key:"overlaps",value:function(t){if(t.path!=this.path)return!1;var e=t.fromPointIndex<this.toPointIndex-3||t.fromPointIndex==this.toPointIndex-3&&t.fromTValue<=this.toTValue,n=t.toPointIndex-3>this.fromPointIndex||t.toPointIndex-3==this.fromPointIndex&&t.toTValue>=this.fromTValue;return e&&n}},{key:"toPath",value:function(){return this.path.slice(this)}},{key:"toString",value:function(){return"fragment".concat(this.path.id?"{".concat(this.path.id,"}"):"","(").concat(this.fromPointIndex,", ").concat(this.toPointIndex,", ").concat(this.fromTValue,", ").concat(this.toTValue,")")}}],[{key:"validate",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(e<0)throw new Error("Invalid fragment fromPointIndex ".concat(e," found. The value must be non-negative."));if(n>t.length-1)throw new Error("Invalid fragment toPointIndex ".concat(n," found. Last point in path index is ").concat(t.length-1,"."));if(isFinite(t.ts)&&isFinite(t.tf)){if(r<0||r>=1)throw new Error("Invalid fragment fromTValue ".concat(r," found. The value must be in the interval [0, 1)."));if(i<=0||i>1)throw new Error("Invalid fragment toTValue ".concat(i," found. The value must be in the interval (0, 1]."));if(n+1-e<4)throw new Error("Invalid fragment points range {".concat(e,", ").concat(n,"} found. At least 4 points are needed to define spline."));if(e==n-3&&i<=r)throw new Error("Invalid fragment T values range {".concat(r,", ").concat(i,"} found. The value must be in the interval (fromTValue, 1]."))}}}]),t}();function Ae(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=c(t);if(e){var i=c(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u(this,n)}}we.Property.X,we.Property.Y;var Ce=function(t){o(i,t);var n=Ae(i);function i(t,r,o){var a;return e(this,i),a=n.call(this,t.length,r,o),Array.isArray(t)&&(t=Object.seal(t)),Object.defineProperty(s(a),"points",{get:function(){return t},enumerable:!0}),a}return r(i,[{key:"clone",value:function(){return new i(this.points.clone(),Object.clone(this.pointProps),this.layout.slice())}},{key:"slice",value:function(t){return new i(this.slicePoints(t.fromPointIndex,t.toPointIndex),Object.clone(this.pointProps),this.layout.slice())}},{key:"slicePoints",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Te.validate(this,t,e,n,r),this.points.slice(t*this.stride,(e+1)*this.stride)}},{key:"toJSON",value:function(){return{type:"ArrayPath",points:this.points,pointProps:this.pointProps,layout:this.layout.map((function(t){return t.name}))}}}],[{key:"fromJSON",value:function(t){if("ArrayPath"!=t.type)throw new Error("ArrayPath deserialization failed. JSON type is ".concat(t.type,", expected ArrayPath."));return new i(t.points,t.pointProps,t.layout.map((function(t){return we.Property[t]})))}}]),i}(_e),Re=function(){function t(){e(this,t)}return r(t,null,[{key:"encode",value:function(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.Encoding.AUTO;if(r==t.Encoding.AUTO&&(r="undefined"==typeof Buffer?"undefined"!=typeof SharedArrayBuffer&&e.buffer instanceof SharedArrayBuffer?t.Encoding.NONE:t.Encoding.ARRAY:t.Encoding.BUFFER),r==t.Encoding.NONE)n=e;else if(r==t.Encoding.ARRAY)n=e.toArray();else{if("undefined"==typeof Buffer)throw new Error("Buffer not found, unable to serialize. Please provide Buffer in global scope.");var i=Buffer.from(e.buffer);switch(r){case t.Encoding.BUFFER:n=i.toJSON();break;case t.Encoding.BASE64:n=i.toString("base64");break;default:throw new Error("Invalid encoding provided: ".concat(r.name))}}return{encoding:r.name,type:e.constructor.name,content:n}}},{key:"decode",value:function(e){var n,r=t.Encoding[e.encoding];if(r==t.Encoding.NONE)n=e.content;else if(r==t.Encoding.ARRAY)n=e.content.toFloat32Array();else{if("undefined"==typeof Buffer)throw new Error("Buffer not found, unable to deserialize. Please provide Buffer in global scope.");var i;switch(r){case t.Encoding.BUFFER:i=Buffer.from(e.content);break;case t.Encoding.BASE64:i=Buffer.from(e.content,"base64");break;default:throw new Error("Invalid encoding provided: ".concat(r.name))}var o=new Uint8Array(i);n=new globalThis[e.type](o.buffer)}return n}},{key:"isTypedArrayData",value:function(t){return t&&t.encoding&&t.type&&t.type.endsWith("Array")}}]),t}();function Ne(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=c(t);if(e){var i=c(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u(this,n)}}Object.defineEnum(Re,"Encoding",["AUTO","NONE","ARRAY","BUFFER","BASE64"]);var Fe=function(t){o(i,t);var n=Ne(i);function i(t,r,o){var a;return e(this,i),a=n.call(this,t.length,r,o),t=Float32Array.createSharedInstance(t),Object.defineProperty(s(a),"points",{get:function(){return t},enumerable:!0}),Object.defineProperty(s(a),"buffer",{get:function(){return t.buffer},set:function(e){if("undefined"!=typeof SharedArrayBuffer&&a.points.buffer instanceof SharedArrayBuffer)throw new Error("Underlying buffer is SharedArrayBuffer and cannot be restored");if(a.points.buffer.byteLength>0)throw new Error("Cannot restore buffer when underlying buffer is not empty");t=new Float32Array(e)}}),a}return r(i,[{key:"clone",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(0==this.buffer.byteLength)throw new Error("Path buffer is empty. Data could be processing under some thread. Clone failed.");return t?new Ce(this.points.toArray(),Object.clone(this.pointProps),this.layout.slice()):new i(this.points.clone(),Object.clone(this.pointProps),this.layout.slice())}},{key:"slice",value:function(t){return new i(this.slicePoints(t.fromPointIndex,t.toPointIndex),Object.clone(this.pointProps),this.layout.slice())}},{key:"slicePoints",value:function(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(Te.validate(this,t,e,r,i),"undefined"!=typeof SharedArrayBuffer&&this.buffer instanceof SharedArrayBuffer){var o=this.points.subarray(t*this.stride,(e+1)*this.stride),a=new SharedArrayBuffer(o.length*Float32Array.BYTES_PER_ELEMENT);(n=new Float32Array(a)).set(o)}else n=this.points.slice(t*this.stride,(e+1)*this.stride);return n}},{key:"toJSON",value:function(){return{type:"SharedPath",points:Re.encode(this.points,this.encoding),pointProps:this.pointProps,layout:this.layout.map((function(t){return t.name}))}}}],[{key:"fromJSON",value:function(t){if("SharedPath"!=t.type)throw new Error("SharedPath deserialization failed. JSON type is ".concat(t.type,", expected SharedPath."));return new i(Re.decode(t.points),t.pointProps,t.layout.map((function(t){return we.Property[t]})))}}]),i}(_e),De=function(){function t(n,r,i,o){e(this,t);var a=n,s=r,u=n+i,c=r+o;Object.defineProperties(this,{left:{value:a,enumerable:!0},x:{value:n,enumerable:!0},bottom:{value:s,enumerable:!0},y:{value:r,enumerable:!0},right:{value:u,enumerable:!0},top:{value:c,enumerable:!0},width:{value:i,enumerable:!0},height:{value:o,enumerable:!0}})}return r(t,[{key:"union",value:function(e){if(e&&!(e instanceof t))throw new TypeError("rect must be instance of RectGL");return e?t.ofEdges(Math.min(this.left,e.left),Math.min(this.bottom,e.bottom),Math.max(this.right,e.right),Math.max(this.top,e.top)):this}},{key:"intersect",value:function(e){if(e&&!(e instanceof t))throw new TypeError("rect must be instance of RectGL");if(!e)return null;var n=t.ofEdges(Math.max(this.left,e.left),Math.max(this.bottom,e.bottom),Math.min(this.right,e.right),Math.min(this.top,e.top));return n.width>0&&n.height>0?n:null}},{key:"ceil",value:function(){return t.ofEdges(Math.floor(this.left),Math.floor(this.bottom),Math.ceil(this.right),Math.ceil(this.top))}},{key:"floor",value:function(){return t.ofEdges(Math.ceil(this.left),Math.ceil(this.bottom),Math.floor(this.right),Math.floor(this.top))}},{key:"transform",value:function(e){if(!e)return this;var n=fe.fromPoint({x:this.left,y:this.bottom}).transform(e),r=fe.fromPoint({x:this.right,y:this.bottom}).transform(e),i=fe.fromPoint({x:this.left,y:this.top}).transform(e),o=fe.fromPoint({x:this.right,y:this.top}).transform(e),a=Math.min(i.x,o.x,n.x,r.x),s=Math.min(i.y,o.y,n.y,r.y),u=Math.max(i.x,o.x,n.x,r.x),c=Math.max(i.y,o.y,n.y,r.y);return t.ofEdges(a,s,u,c)}},{key:"toQuad",value:function(t){var e;if(t){var n=fe.fromPoint({x:this.left,y:this.bottom}).transform(t),r=fe.fromPoint({x:this.right,y:this.bottom}).transform(t),i=fe.fromPoint({x:this.left,y:this.top}).transform(t),o=fe.fromPoint({x:this.right,y:this.top}).transform(t);e=Jt(n.x,n.y,r.x,r.y,i.x,i.y,o.x,o.y)}else e=Jt(this.left,this.bottom,this.right,this.bottom,this.left,this.top,this.right,this.top);return e}},{key:"toString",value:function(){return"gl-rect(".concat(this.x,", ").concat(this.y,", ").concat(this.width,", ").concat(this.height,")")}}],[{key:"ofEdges",value:function(e,n,r,i){return new t(e,n,r-e,i-n)}},{key:"calculateBrushGLSegmentBounds",value:function(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,o=[{x:-1,y:-1},{x:1,y:-1},{x:-1,y:1},{x:1,y:1}],a=.5*e.size,s=Math.abs(r*a);if(i){var u=new fe(e.x,e.y,e.x,e.z);n=u.transform(i)}else n=e;var c=n.x,l=n.y,h=e.scaleX*a,f=e.scaleY*a,p=e.offsetX,d=-e.offsetY,y=Math.cos(e.rotation),v=Math.sin(e.rotation),m=Number.MAX_SAFE_INTEGER,g=Number.MIN_SAFE_INTEGER,b=Number.MAX_SAFE_INTEGER,x=Number.MIN_SAFE_INTEGER;return o.forEach((function(t){t.x=t.x*h+p,t.y=t.y*f+d;var e=y*t.x+v*t.y+c,n=-v*t.x+y*t.y+l,r=e-s;m=Math.min(m,r),g=Math.max(g,r),r=e+s,m=Math.min(m,r),g=Math.max(g,r);var i=n-s;b=Math.min(b,i),x=Math.max(x,i),i=n+s,b=Math.min(b,i),x=Math.max(x,i)})),t.ofEdges(m,b,g,x)}}]),t}();Object.defineProperty(De,"SQURE",{value:Object.freeze([Object.freeze({x:-1,y:-1}),Object.freeze({x:1,y:-1}),Object.freeze({x:-1,y:1}),Object.freeze({x:1,y:1})]),enumerable:!0});var je=function(){function t(n,r,i,o){e(this,t);var a,s,u=n,c=r,l=n+i,h=r+o;Object.defineProperties(this,{left:{value:u,enumerable:!0},top:{value:c,enumerable:!0},right:{value:l,enumerable:!0},bottom:{value:h,enumerable:!0},x:{value:n,enumerable:!0},y:{value:r,enumerable:!0},width:{value:i,enumerable:!0},height:{value:o,enumerable:!0},size:{get:function(){return a||(a={width:i,height:o}),a},enumerable:!0},center:{get:function(){return s||(s={x:(u+l)/2,y:(c+h)/2}),s},enumerable:!0}})}return r(t,[{key:"union",value:function(e){return e?t.ofEdges(Math.min(this.left,e.left),Math.min(this.top,e.top),Math.max(this.right,e.right),Math.max(this.bottom,e.bottom)):this}},{key:"intersect",value:function(e){if(!e)return null;var n=t.ofEdges(Math.max(this.left,e.left),Math.max(this.top,e.top),Math.min(this.right,e.right),Math.min(this.bottom,e.bottom));return n.width>0&&n.height>0?n:null}},{key:"intersects",value:function(t){return this.left<=t.right&&this.right>=t.left&&this.top<=t.bottom&&this.bottom>=t.top}},{key:"ceil",value:function(e){var n=Math.floor(this.left),r=Math.floor(this.top),i=Math.ceil(this.right),o=Math.ceil(this.bottom);if(e){var a=i-n,s=o-r;i=n+(a+=a%2),o=r+(s+=s%2)}return t.ofEdges(n,r,i,o)}},{key:"floor",value:function(e){var n=Math.ceil(this.left),r=Math.ceil(this.top),i=Math.floor(this.right),o=Math.floor(this.bottom);if(e){var a=i-n,s=o-r;i=n+(a-=a%2),o=r+(s-=s%2)}return t.ofEdges(n,r,i,o)}},{key:"contains",value:function(t){return this.left<=t.x&&this.right>=t.x&&this.top<=t.y&&this.bottom>=t.y}},{key:"includes",value:function(t){return this.left<=t.left&&this.right>=t.right&&this.top<=t.top&&this.bottom>=t.bottom}},{key:"transform",value:function(e){if(!e)return this;var n=fe.fromPoint({x:this.left,y:this.top}).transform(e),r=fe.fromPoint({x:this.right,y:this.top}).transform(e),i=fe.fromPoint({x:this.left,y:this.bottom}).transform(e),o=fe.fromPoint({x:this.right,y:this.bottom}).transform(e),a=Math.min(n.x,r.x,i.x,o.x),s=Math.min(n.y,r.y,i.y,o.y),u=Math.max(n.x,r.x,i.x,o.x),c=Math.max(n.y,r.y,i.y,o.y);return t.ofEdges(a,s,u,c)}},{key:"toPath",value:function(t){throw new Error("Rect.toPath is deprecated. Try oneof (ArrayPath, SharedPath, Spline).fromRect(rect, pointProps)")}},{key:"toGLRect",value:function(){return new De(this.x,this.y,this.width,this.height)}},{key:"toString",value:function(){return"rect(".concat(this.x,", ").concat(this.y,", ").concat(this.width,", ").concat(this.height,")")}},{key:"toJSON",value:function(){return{x:this.left,y:this.top,width:this.width,height:this.height}}}],[{key:"fromGLRect",value:function(e){if(!e)return null;if(!(e instanceof De))throw new TypeError("rect must be instance of RectGL");return new t(e.left,e.bottom,e.width,e.height)}},{key:"isRect",value:function(t){return t&&isFinite(t.left)&&isFinite(t.top)&&isFinite(t.width)&&isFinite(t.height)}},{key:"fromString",value:function(e){return e=e.substring(e.indexOf("(")+1,e.indexOf(")")).split(/,\s*/g),new t(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]))}},{key:"fromRect",value:function(e){return"string"==typeof e?t.fromString(e):new t(e.x,e.y,e.width,e.height)}},{key:"ofPolygon",value:function(e){if(e.shape&&(e=e.shape),0==e.length)return null;for(var n=Number.MAX_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,a=0;a<e.length;a++){var s=e.getPointX(a),u=e.getPointY(a);n=Math.min(n,s),r=Math.min(r,u),i=Math.max(i,s),o=Math.max(o,u)}return t.ofEdges(n,r,i,o)}},{key:"ofSpline",value:function(e){for(var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=0;i<e.length;i++)n=De.calculateBrushGLSegmentBounds(e.getPoint(i),r).union(n);return t.fromGLRect(n)}},{key:"ofEdges",value:function(e,n,r,i){return new t(e,n,r-e,i-n)}},{key:"union",value:function(t,e){return t?e?t.union(e):t:e}},{key:"intersect",value:function(t,e){return t&&e?t.intersect(e):null}}]),t}();function Le(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=c(t);if(e){var i=c(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u(this,n)}}var Be=function(t){o(i,t);var n=Le(i);function i(t,r,o){var a,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return e(this,i),(a=n.call(this,r,o,t)).ts=u,a.tf=c,Object.defineProperty(s(a),"segmentsCount",{value:a.length-3,configurable:!0}),Object.defineProperty(s(a),"bounds",{get:function(){return je.ofSpline(s(a),a.pointProps.scattering).ceil()},enumerable:!0}),Object.defineProperty(s(a),"color",{get:function(){return Ee.isColor(a.pointProps)?Ee.fromColor(a.pointProps):void 0},set:function(t){if(!t)throw new Error("Spline color cannot be removed");if(!(t instanceof Ee))throw new Error("Expected value should be Color instance");"red"in a.pointProps&&(a.pointProps.red=t.red),"green"in a.pointProps&&(a.pointProps.green=t.green),"blue"in a.pointProps&&(a.pointProps.blue=t.blue),"alpha"in a.pointProps&&(a.pointProps.alpha=t.alpha)},enumerable:!0}),a.validate(),a}return r(i,[{key:"validate",value:function(){if(!this.layout.includes(we.Property.X))throw new Error("Layout doesn't contains required properties X");if(!this.layout.includes(we.Property.Y))throw new Error("Layout doesn't contains required properties Y");if(0==this.points.length)throw new Error("Empty spline is not allowed");if(this.points.length%this.stride!=0)throw new Error("Path length doesn't match the stride provided via the layout");if(this.ts<0||this.ts>=1)throw new Error("Invalid spline ts ".concat(this.ts," found. The value must be in the interval [0, 1)."));if(this.tf<=0||this.tf>1)throw new Error("Invalid spline tf ".concat(this.tf," found. The value must be in the interval (0, 1]."));if(1==this.segmentsCount&&this.ts>this.tf)throw new Error("Invalid spline t range ".concat(this.ts," - ").concat(this.tf," found. Spline has only one segment and ts <= tf."));if(this.segmentsCount<1)throw new Error("Incompleted spline found. Spline is defined with at least 4 control points.")}},{key:"clone",value:function(){return new i(this.layout.slice(),this.points.clone(),Object.clone(this.pointProps),this.ts,this.tf)}},{key:"getSegment",value:function(t){var e=t,n=t+3,r=0==e?this.ts:0,i=n+1==this.length?this.tf:1;return this.slice({fromPointIndex:e,toPointIndex:n,fromTValue:r,toTValue:i})}},{key:"slice",value:function(t){var e=this.slicePoints(t.fromPointIndex,t.toPointIndex,t.fromTValue,t.toTValue),n=new i(this.layout.slice(),e,Object.clone(this.pointProps),t.fromTValue,t.toTValue);return n.id=t.id,n}},{key:"toPlainPath",value:function(){for(var t=[],e=0;e<this.length;e++)t.push(this.getPointX(),this.getPointY());return new Ce(t)}},{key:"toJSON",value:function(){return{type:"Spline",id:this.id,layout:this.layout.map((function(t){return t.name})),points:Re.encode(this.points,this.encoding),pointProps:this.pointProps,ts:this.ts,tf:this.tf}}}],[{key:"fromJSON",value:function(t){var e=Re.decode(t.points),n=new i(t.layout.map((function(t){return we.Property[t]})),e,t.pointProps,t.ts,t.tf);return n.id=t.id,n}},{key:"fromRect",value:function(t,e){return new i(void 0,[t.left,t.top,t.left,t.top,t.right,t.top,t.right,t.bottom,t.left,t.bottom,t.left,t.top,t.left,t.top],e)}}]),i}(Fe);function ze(t,e,n){return(ze="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Ye(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=c(t);if(e){var i=c(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u(this,n)}}var Xe=function(t){o(i,t);var n=Ye(i);function i(t,r,o){var a,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];e(this,i),a=n.call(this,r,o,t),u.length>0&&!Object.isFrozen(u.first)&&u.forEach((function(t){return Object.freeze(t)})),Object.defineProperty(s(a),"splineParameters",{value:Object.freeze(u),enumerable:!0});var c=new Ie(t,o);return Object.defineProperty(s(a),"style",{get:function(){return c.style},set:function(t){return c.style.reset(t)},enumerable:!0}),Object.defineProperty(s(a),"color",{get:function(){return a.style.color},set:function(t){if(!t)throw new Error("Spline color cannot be removed");if(!(t instanceof Ee))throw new Error("Expected value should be Color instance");"red"in a.pointProps&&(a.pointProps.red=t.red),"green"in a.pointProps&&(a.pointProps.green=t.green),"blue"in a.pointProps&&(a.pointProps.blue=t.blue),"alpha"in a.pointProps&&(a.pointProps.alpha=t.alpha)},enumerable:!0}),Object.defineProperty(s(a),"bounds",{get:function(){return je.ofSpline(s(a),a.pointProps.scattering).ceil()},enumerable:!0}),a.validate(),a}return r(i,[{key:"validate",value:function(){if(!this.layout.includes(we.Property.X))throw new Error("Layout doesn't contains required properties X");if(!this.layout.includes(we.Property.Y))throw new Error("Layout doesn't contains required properties Y");if(0==this.points.length)throw new Error("Empty spline is not allowed");if(this.points.length%this.stride!=0)throw new Error("Path length doesn't match the stride provided via the layout")}},{key:"clone",value:function(){return new i(this.layout.slice(),this.points.clone(),Object.clone(this.pointProps),this.splineParameters.slice())}},{key:"getPoint",value:function(t){return ze(c(i.prototype),"getPoint",this).call(this,t,this.style)}},{key:"getPointSegmentIndex",value:function(t){return this.splineParameters[t]?this.splineParameters[t].index:void 0}},{key:"getPointT",value:function(t){return this.splineParameters[t]?this.splineParameters[t].t:void 0}},{key:"getPointParameter",value:function(t){return this.splineParameters[t]}},{key:"toJSON",value:function(){return{type:"InterpolatedSpline",layout:this.layout.map((function(t){return t.name})),points:Re.encode(this.points,this.encoding),pointProps:this.pointProps,splineParameters:this.splineParameters}}}],[{key:"fromJSON",value:function(t){var e=Re.decode(t.points);return new i(t.layout.map((function(t){return we.Property[t]})),e,t.pointProps,t.splineParameters)}},{key:"fromRect",value:function(t,e){throw new Error("InterpolatedSpline.fromRect is not supported. Try Spline.fromRect and interpolate with particular Spline interpolator.")}}]),i}(Fe),We={},Ve="1.5.0";function Ue(t){return"("+t.x+";"+t.y+")"}var qe={toString:function(t){var e=t.toString();return"[object Object]"===e?Ue(t):e},toStringBase:Ue,compare:function(t,e){return t.y===e.y?t.x-e.x:t.y-e.y},equals:function(t,e){return t.x===e.x&&t.y===e.y}},Je=qe,Ge=function(t,e){this.name="PointError",this.points=e=e||[],this.message=t||"Invalid Points!";for(var n=0;n<e.length;n++)this.message+=" "+Je.toString(e[n])};(Ge.prototype=new Error).constructor=Ge;var Ze=Ge,He=qe,Ke=function(t,e){this.x=+t||0,this.y=+e||0,this._p2t_edge_list=null};Ke.prototype.toString=function(){return He.toStringBase(this)},Ke.prototype.toJSON=function(){return{x:this.x,y:this.y}},Ke.prototype.clone=function(){return new Ke(this.x,this.y)},Ke.prototype.set_zero=function(){return this.x=0,this.y=0,this},Ke.prototype.set=function(t,e){return this.x=+t||0,this.y=+e||0,this},Ke.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},Ke.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},Ke.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},Ke.prototype.mul=function(t){return this.x*=t,this.y*=t,this},Ke.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Ke.prototype.normalize=function(){var t=this.length();return this.x/=t,this.y/=t,t},Ke.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},Ke.negate=function(t){return new Ke(-t.x,-t.y)},Ke.add=function(t,e){return new Ke(t.x+e.x,t.y+e.y)},Ke.sub=function(t,e){return new Ke(t.x-e.x,t.y-e.y)},Ke.mul=function(t,e){return new Ke(t*e.x,t*e.y)},Ke.cross=function(t,e){return"number"==typeof t?"number"==typeof e?t*e:new Ke(-t*e.y,t*e.x):"number"==typeof e?new Ke(e*t.y,-e*t.x):t.x*e.y-t.y*e.x},Ke.toString=He.toString,Ke.compare=He.compare,Ke.cmp=He.compare,Ke.equals=He.equals,Ke.dot=function(t,e){return t.x*e.x+t.y*e.y};var $e=Ke,Qe=function(t,e,n){this.points_=[t,e,n],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},tn=qe.toString;Qe.prototype.toString=function(){return"["+tn(this.points_[0])+tn(this.points_[1])+tn(this.points_[2])+"]"},Qe.prototype.getPoint=function(t){return this.points_[t]},Qe.prototype.GetPoint=Qe.prototype.getPoint,Qe.prototype.getPoints=function(){return this.points_},Qe.prototype.getNeighbor=function(t){return this.neighbors_[t]},Qe.prototype.containsPoint=function(t){var e=this.points_;return t===e[0]||t===e[1]||t===e[2]},Qe.prototype.containsEdge=function(t){return this.containsPoint(t.p)&&this.containsPoint(t.q)},Qe.prototype.containsPoints=function(t,e){return this.containsPoint(t)&&this.containsPoint(e)},Qe.prototype.isInterior=function(){return this.interior_},Qe.prototype.setInterior=function(t){return this.interior_=t,this},Qe.prototype.markNeighborPointers=function(t,e,n){var r=this.points_;if(t===r[2]&&e===r[1]||t===r[1]&&e===r[2])this.neighbors_[0]=n;else if(t===r[0]&&e===r[2]||t===r[2]&&e===r[0])this.neighbors_[1]=n;else{if(!(t===r[0]&&e===r[1]||t===r[1]&&e===r[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=n}},Qe.prototype.markNeighbor=function(t){var e=this.points_;t.containsPoints(e[1],e[2])?(this.neighbors_[0]=t,t.markNeighborPointers(e[1],e[2],this)):t.containsPoints(e[0],e[2])?(this.neighbors_[1]=t,t.markNeighborPointers(e[0],e[2],this)):t.containsPoints(e[0],e[1])&&(this.neighbors_[2]=t,t.markNeighborPointers(e[0],e[1],this))},Qe.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},Qe.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},Qe.prototype.pointCW=function(t){var e=this.points_;return t===e[0]?e[2]:t===e[1]?e[0]:t===e[2]?e[1]:null},Qe.prototype.pointCCW=function(t){var e=this.points_;return t===e[0]?e[1]:t===e[1]?e[2]:t===e[2]?e[0]:null},Qe.prototype.neighborCW=function(t){return t===this.points_[0]?this.neighbors_[1]:t===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},Qe.prototype.neighborCCW=function(t){return t===this.points_[0]?this.neighbors_[2]:t===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},Qe.prototype.getConstrainedEdgeCW=function(t){return t===this.points_[0]?this.constrained_edge[1]:t===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},Qe.prototype.getConstrainedEdgeCCW=function(t){return t===this.points_[0]?this.constrained_edge[2]:t===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},Qe.prototype.getConstrainedEdgeAcross=function(t){return t===this.points_[0]?this.constrained_edge[0]:t===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},Qe.prototype.setConstrainedEdgeCW=function(t,e){t===this.points_[0]?this.constrained_edge[1]=e:t===this.points_[1]?this.constrained_edge[2]=e:this.constrained_edge[0]=e},Qe.prototype.setConstrainedEdgeCCW=function(t,e){t===this.points_[0]?this.constrained_edge[2]=e:t===this.points_[1]?this.constrained_edge[0]=e:this.constrained_edge[1]=e},Qe.prototype.getDelaunayEdgeCW=function(t){return t===this.points_[0]?this.delaunay_edge[1]:t===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},Qe.prototype.getDelaunayEdgeCCW=function(t){return t===this.points_[0]?this.delaunay_edge[2]:t===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},Qe.prototype.setDelaunayEdgeCW=function(t,e){t===this.points_[0]?this.delaunay_edge[1]=e:t===this.points_[1]?this.delaunay_edge[2]=e:this.delaunay_edge[0]=e},Qe.prototype.setDelaunayEdgeCCW=function(t,e){t===this.points_[0]?this.delaunay_edge[2]=e:t===this.points_[1]?this.delaunay_edge[0]=e:this.delaunay_edge[1]=e},Qe.prototype.neighborAcross=function(t){return t===this.points_[0]?this.neighbors_[0]:t===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},Qe.prototype.oppositePoint=function(t,e){var n=t.pointCW(e);return this.pointCW(n)},Qe.prototype.legalize=function(t,e){var n=this.points_;if(t===n[0])n[1]=n[0],n[0]=n[2],n[2]=e;else if(t===n[1])n[2]=n[1],n[1]=n[0],n[0]=e;else{if(t!==n[2])throw new Error("poly2tri Invalid Triangle.legalize() call");n[0]=n[2],n[2]=n[1],n[1]=e}},Qe.prototype.index=function(t){var e=this.points_;if(t===e[0])return 0;if(t===e[1])return 1;if(t===e[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},Qe.prototype.edgeIndex=function(t,e){var n=this.points_;if(t===n[0]){if(e===n[1])return 2;if(e===n[2])return 1}else if(t===n[1]){if(e===n[2])return 0;if(e===n[0])return 2}else if(t===n[2]){if(e===n[0])return 1;if(e===n[1])return 0}return-1},Qe.prototype.markConstrainedEdgeByIndex=function(t){this.constrained_edge[t]=!0},Qe.prototype.markConstrainedEdgeByEdge=function(t){this.markConstrainedEdgeByPoints(t.p,t.q)},Qe.prototype.markConstrainedEdgeByPoints=function(t,e){var n=this.points_;e===n[0]&&t===n[1]||e===n[1]&&t===n[0]?this.constrained_edge[2]=!0:e===n[0]&&t===n[2]||e===n[2]&&t===n[0]?this.constrained_edge[1]=!0:(e===n[1]&&t===n[2]||e===n[2]&&t===n[1])&&(this.constrained_edge[0]=!0)};var en=Qe,nn={};var rn=function(t,e){if(!t)throw new Error(e||"Assert Failed")},on={exports:{}},an=function(t,e){this.head_=t,this.tail_=e,this.search_node_=t};an.prototype.head=function(){return this.head_},an.prototype.setHead=function(t){this.head_=t},an.prototype.tail=function(){return this.tail_},an.prototype.setTail=function(t){this.tail_=t},an.prototype.search=function(){return this.search_node_},an.prototype.setSearch=function(t){this.search_node_=t},an.prototype.findSearchNode=function(){return this.search_node_},an.prototype.locateNode=function(t){var e=this.search_node_;if(t<e.value){for(;e=e.prev;)if(t>=e.value)return this.search_node_=e,e}else for(;e=e.next;)if(t<e.value)return this.search_node_=e.prev,e.prev;return null},an.prototype.locatePoint=function(t){var e=t.x,n=this.findSearchNode(e),r=n.point.x;if(e===r){if(t!==n.point)if(t===n.prev.point)n=n.prev;else{if(t!==n.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");n=n.next}}else if(e<r)for(;(n=n.prev)&&t!==n.point;);else for(;(n=n.next)&&t!==n.point;);return n&&(this.search_node_=n),n},on.exports=an,on.exports.Node=function(t,e){this.point=t,this.triangle=e||null,this.next=null,this.prev=null,this.value=t.x};var sn={},un=1e-12;sn.EPSILON=un;var cn={CW:1,CCW:-1,COLLINEAR:0};sn.Orientation=cn,sn.orient2d=function(t,e,n){var r=(t.x-n.x)*(e.y-n.y)-(t.y-n.y)*(e.x-n.x);return r>-1e-12&&r<un?cn.COLLINEAR:r>0?cn.CCW:cn.CW},sn.inScanArea=function(t,e,n,r){return!((t.x-e.x)*(r.y-e.y)-(r.x-e.x)*(t.y-e.y)>=-1e-12)&&!((t.x-n.x)*(r.y-n.y)-(r.x-n.x)*(t.y-n.y)<=un)},sn.isAngleObtuse=function(t,e,n){var r=e.x-t.x,i=e.y-t.y;return r*(n.x-t.x)+i*(n.y-t.y)<0};var ln=rn,hn=Ze,fn=en,pn=on.exports.Node,dn=sn,yn=dn.EPSILON,vn=dn.Orientation,mn=dn.orient2d,gn=dn.inScanArea,bn=dn.isAngleObtuse;function xn(t,e){var n=t.locateNode(e),r=function(t,e,n){var r=new fn(e,n.point,n.next.point);r.markNeighbor(n.triangle),t.addToMap(r);var i=new pn(e);i.next=n.next,i.prev=n,n.next.prev=i,n.next=i,kn(t,r)||t.mapTriangleToNodes(r);return i}(t,e,n);return e.x<=n.point.x+yn&&Sn(t,n),function(t,e){var n=e.next;for(;n.next&&!bn(n.point,n.next.point,n.prev.point);)Sn(t,n),n=n.next;n=e.prev;for(;n.prev&&!bn(n.point,n.next.point,n.prev.point);)Sn(t,n),n=n.prev;e.next&&e.next.next&&function(t){var e=t.point.x-t.next.next.point.x,n=t.point.y-t.next.next.point.y;return ln(n>=0,"unordered y"),e>=0||Math.abs(e)<n}(e)&&function(t,e){mn(e.point,e.next.point,e.next.next.point)===vn.CCW?t.basin.left_node=e.next.next:t.basin.left_node=e.next;t.basin.bottom_node=t.basin.left_node;for(;t.basin.bottom_node.next&&t.basin.bottom_node.point.y>=t.basin.bottom_node.next.point.y;)t.basin.bottom_node=t.basin.bottom_node.next;if(t.basin.bottom_node===t.basin.left_node)return;t.basin.right_node=t.basin.bottom_node;for(;t.basin.right_node.next&&t.basin.right_node.point.y<t.basin.right_node.next.point.y;)t.basin.right_node=t.basin.right_node.next;if(t.basin.right_node===t.basin.bottom_node)return;t.basin.width=t.basin.right_node.point.x-t.basin.left_node.point.x,t.basin.left_highest=t.basin.left_node.point.y>t.basin.right_node.point.y,Mn(t,t.basin.bottom_node)}(t,e)}(t,r),r}function Pn(t,e,n){t.edge_event.constrained_edge=e,t.edge_event.right=e.p.x>e.q.x,En(n.triangle,e.p,e.q)||(!function(t,e,n){t.edge_event.right?function(t,e,n){for(;n.next.point.x<e.p.x;)mn(e.q,n.next.point,e.p)===vn.CCW?_n(t,e,n):n=n.next}(t,e,n):function(t,e,n){for(;n.prev.point.x>e.p.x;)mn(e.q,n.prev.point,e.p)===vn.CW?Cn(t,e,n):n=n.prev}(t,e,n)}(t,e,n),wn(t,e.p,e.q,n.triangle,e.q))}function wn(t,e,n,r,i){if(!En(r,e,n)){var o=r.pointCCW(i),a=mn(n,o,e);if(a===vn.COLLINEAR)throw new hn("poly2tri EdgeEvent: Collinear not supported!",[n,o,e]);var s=r.pointCW(i),u=mn(n,s,e);if(u===vn.COLLINEAR)throw new hn("poly2tri EdgeEvent: Collinear not supported!",[n,s,e]);a===u?wn(t,e,n,r=a===vn.CW?r.neighborCCW(i):r.neighborCW(i),i):Fn(t,e,n,r,i)}}function En(t,e,n){var r=t.edgeIndex(e,n);if(-1!==r){t.markConstrainedEdgeByIndex(r);var i=t.getNeighbor(r);return i&&i.markConstrainedEdgeByPoints(e,n),!0}return!1}function Sn(t,e){var n=new fn(e.prev.point,e.point,e.next.point);n.markNeighbor(e.prev.triangle),n.markNeighbor(e.triangle),t.addToMap(n),e.prev.next=e.next,e.next.prev=e.prev,kn(t,n)||t.mapTriangleToNodes(n)}function kn(t,e){for(var n=0;n<3;++n)if(!e.delaunay_edge[n]){var r=e.getNeighbor(n);if(r){var i=e.getPoint(n),o=r.oppositePoint(e,i),a=r.index(o);if(r.constrained_edge[a]||r.delaunay_edge[a]){e.constrained_edge[n]=r.constrained_edge[a];continue}if(On(i,e.pointCCW(i),e.pointCW(i),o)){e.delaunay_edge[n]=!0,r.delaunay_edge[a]=!0,In(e,i,r,o);var s=!kn(t,e);return s&&t.mapTriangleToNodes(e),(s=!kn(t,r))&&t.mapTriangleToNodes(r),e.delaunay_edge[n]=!1,r.delaunay_edge[a]=!1,!0}}}return!1}function On(t,e,n,r){var i=t.x-r.x,o=t.y-r.y,a=e.x-r.x,s=e.y-r.y,u=i*s-a*o;if(u<=0)return!1;var c=n.x-r.x,l=n.y-r.y,h=c*o-i*l;return!(h<=0)&&(i*i+o*o)*(a*l-c*s)+(a*a+s*s)*h+(c*c+l*l)*u>0}function In(t,e,n,r){var i,o,a,s,u,c,l,h,f,p,d,y;i=t.neighborCCW(e),o=t.neighborCW(e),a=n.neighborCCW(r),s=n.neighborCW(r),u=t.getConstrainedEdgeCCW(e),c=t.getConstrainedEdgeCW(e),l=n.getConstrainedEdgeCCW(r),h=n.getConstrainedEdgeCW(r),f=t.getDelaunayEdgeCCW(e),p=t.getDelaunayEdgeCW(e),d=n.getDelaunayEdgeCCW(r),y=n.getDelaunayEdgeCW(r),t.legalize(e,r),n.legalize(r,e),n.setDelaunayEdgeCCW(e,f),t.setDelaunayEdgeCW(e,p),t.setDelaunayEdgeCCW(r,d),n.setDelaunayEdgeCW(r,y),n.setConstrainedEdgeCCW(e,u),t.setConstrainedEdgeCW(e,c),t.setConstrainedEdgeCCW(r,l),n.setConstrainedEdgeCW(r,h),t.clearNeighbors(),n.clearNeighbors(),i&&n.markNeighbor(i),o&&t.markNeighbor(o),a&&t.markNeighbor(a),s&&n.markNeighbor(s),t.markNeighbor(n)}function Mn(t,e){if(!function(t,e){var n;n=t.basin.left_highest?t.basin.left_node.point.y-e.point.y:t.basin.right_node.point.y-e.point.y;if(t.basin.width>n)return!0;return!1}(t,e)&&(Sn(t,e),e.prev!==t.basin.left_node||e.next!==t.basin.right_node)){if(e.prev===t.basin.left_node){if(mn(e.point,e.next.point,e.next.next.point)===vn.CW)return;e=e.next}else if(e.next===t.basin.right_node){if(mn(e.point,e.prev.point,e.prev.prev.point)===vn.CCW)return;e=e.prev}else e=e.prev.point.y<e.next.point.y?e.prev:e.next;Mn(t,e)}}function _n(t,e,n){n.point.x<e.p.x&&(mn(n.point,n.next.point,n.next.next.point)===vn.CCW?Tn(t,e,n):(An(t,e,n),_n(t,e,n)))}function Tn(t,e,n){Sn(t,n.next),n.next.point!==e.p&&mn(e.q,n.next.point,e.p)===vn.CCW&&mn(n.point,n.next.point,n.next.next.point)===vn.CCW&&Tn(t,e,n)}function An(t,e,n){mn(n.next.point,n.next.next.point,n.next.next.next.point)===vn.CCW?Tn(t,e,n.next):mn(e.q,n.next.next.point,e.p)===vn.CCW&&An(t,e,n.next)}function Cn(t,e,n){n.point.x>e.p.x&&(mn(n.point,n.prev.point,n.prev.prev.point)===vn.CW?Nn(t,e,n):(Rn(t,e,n),Cn(t,e,n)))}function Rn(t,e,n){mn(n.prev.point,n.prev.prev.point,n.prev.prev.prev.point)===vn.CW?Nn(t,e,n.prev):mn(e.q,n.prev.prev.point,e.p)===vn.CW&&Rn(t,e,n.prev)}function Nn(t,e,n){Sn(t,n.prev),n.prev.point!==e.p&&mn(e.q,n.prev.point,e.p)===vn.CW&&mn(n.point,n.prev.point,n.prev.prev.point)===vn.CW&&Nn(t,e,n)}function Fn(t,e,n,r,i){var o=r.neighborAcross(i);ln(o,"FLIP failed due to missing triangle!");var a=o.oppositePoint(r,i);if(r.getConstrainedEdgeAcross(i)){var s=r.index(i);throw new hn("poly2tri Intersecting Constraints",[i,a,r.getPoint((s+1)%3),r.getPoint((s+2)%3)])}gn(i,r.pointCCW(i),r.pointCW(i),a)?(In(r,i,o,a),t.mapTriangleToNodes(r),t.mapTriangleToNodes(o),i===n&&a===e?n===t.edge_event.constrained_edge.q&&e===t.edge_event.constrained_edge.p&&(r.markConstrainedEdgeByPoints(e,n),o.markConstrainedEdgeByPoints(e,n),kn(t,r),kn(t,o)):Fn(t,e,n,r=function(t,e,n,r,i,o){var a;if(e===vn.CCW)return a=r.edgeIndex(i,o),r.delaunay_edge[a]=!0,kn(t,r),r.clearDelaunayEdges(),n;return a=n.edgeIndex(i,o),n.delaunay_edge[a]=!0,kn(t,n),n.clearDelaunayEdges(),r}(t,mn(n,a,e),r,o,i,a),i)):(jn(t,e,n,r,o,Dn(e,n,o,a)),wn(t,e,n,r,i))}function Dn(t,e,n,r){var i=mn(e,r,t);if(i===vn.CW)return n.pointCCW(r);if(i===vn.CCW)return n.pointCW(r);throw new hn("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[e,r,t])}function jn(t,e,n,r,i,o){var a=i.neighborAcross(o);ln(a,"FLIP failed due to missing triangle");var s=a.oppositePoint(i,o);gn(n,r.pointCCW(n),r.pointCW(n),s)?Fn(t,n,s,a,s):jn(t,e,n,r,a,Dn(e,n,a,s))}nn.triangulate=function(t){t.initTriangulation(),t.createAdvancingFront(),function(t){var e,n=t.pointCount();for(e=1;e<n;++e)for(var r=t.getPoint(e),i=xn(t,r),o=r._p2t_edge_list,a=0;o&&a<o.length;++a)Pn(t,o[a],i)}(t),function(t){var e=t.front().head().next.triangle,n=t.front().head().next.point;for(;!e.getConstrainedEdgeCW(n);)e=e.neighborCCW(n);t.meshClean(e)}(t)};var Ln=Ze,Bn=$e,zn=en,Yn=nn,Xn=on.exports,Wn=Xn.Node,Vn=function(t,e){if(this.p=t,this.q=e,t.y>e.y)this.q=t,this.p=e;else if(t.y===e.y)if(t.x>e.x)this.q=t,this.p=e;else if(t.x===e.x)throw new Ln("poly2tri Invalid Edge constructor: repeated points!",[t]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},Un=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};Un.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var qn=function(){this.constrained_edge=null,this.right=!1},Jn=function(t,e){e=e||{},this.triangles_=[],this.map_=[],this.points_=e.cloneArrays?t.slice(0):t,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new Un,this.edge_event=new qn,this.initEdges(this.points_)};Jn.prototype.addHole=function(t){this.initEdges(t);var e,n=t.length;for(e=0;e<n;e++)this.points_.push(t[e]);return this},Jn.prototype.AddHole=Jn.prototype.addHole,Jn.prototype.addHoles=function(t){var e,n=t.length;for(e=0;e<n;e++)this.initEdges(t[e]);return this.points_=this.points_.concat.apply(this.points_,t),this},Jn.prototype.addPoint=function(t){return this.points_.push(t),this},Jn.prototype.AddPoint=Jn.prototype.addPoint,Jn.prototype.addPoints=function(t){return this.points_=this.points_.concat(t),this},Jn.prototype.triangulate=function(){return Yn.triangulate(this),this},Jn.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},Jn.prototype.getTriangles=function(){return this.triangles_},Jn.prototype.GetTriangles=Jn.prototype.getTriangles,Jn.prototype.front=function(){return this.front_},Jn.prototype.pointCount=function(){return this.points_.length},Jn.prototype.head=function(){return this.head_},Jn.prototype.setHead=function(t){this.head_=t},Jn.prototype.tail=function(){return this.tail_},Jn.prototype.setTail=function(t){this.tail_=t},Jn.prototype.getMap=function(){return this.map_},Jn.prototype.initTriangulation=function(){var t,e=this.points_[0].x,n=this.points_[0].x,r=this.points_[0].y,i=this.points_[0].y,o=this.points_.length;for(t=1;t<o;t++){var a=this.points_[t];a.x>e&&(e=a.x),a.x<n&&(n=a.x),a.y>r&&(r=a.y),a.y<i&&(i=a.y)}this.pmin_=new Bn(n,i),this.pmax_=new Bn(e,r);var s=.3*(e-n),u=.3*(r-i);this.head_=new Bn(e+s,i-u),this.tail_=new Bn(n-s,i-u),this.points_.sort(Bn.compare)},Jn.prototype.initEdges=function(t){var e,n=t.length;for(e=0;e<n;++e)this.edge_list.push(new Vn(t[e],t[(e+1)%n]))},Jn.prototype.getPoint=function(t){return this.points_[t]},Jn.prototype.addToMap=function(t){this.map_.push(t)},Jn.prototype.locateNode=function(t){return this.front_.locateNode(t.x)},Jn.prototype.createAdvancingFront=function(){var t,e,n,r=new zn(this.points_[0],this.tail_,this.head_);this.map_.push(r),t=new Wn(r.getPoint(1),r),e=new Wn(r.getPoint(0),r),n=new Wn(r.getPoint(2)),this.front_=new Xn(t,n),t.next=e,e.next=n,e.prev=t,n.prev=e},Jn.prototype.removeNode=function(t){},Jn.prototype.mapTriangleToNodes=function(t){for(var e=0;e<3;++e)if(!t.getNeighbor(e)){var n=this.front_.locatePoint(t.pointCW(t.getPoint(e)));n&&(n.triangle=t)}},Jn.prototype.removeFromMap=function(t){var e,n=this.map_,r=n.length;for(e=0;e<r;e++)if(n[e]===t){n.splice(e,1);break}},Jn.prototype.meshClean=function(t){for(var e,n,r=[t];e=r.pop();)if(!e.isInterior())for(e.setInterior(!0),this.triangles_.push(e),n=0;n<3;n++)e.constrained_edge[n]||r.push(e.getNeighbor(n))};var Gn=Jn;!function(t){var e=H.poly2tri;t.noConflict=function(){return H.poly2tri=e,t},t.VERSION=Ve,t.PointError=Ze,t.Point=$e,t.Triangle=en,t.SweepContext=Gn;var n=nn;t.triangulate=n.triangulate,t.sweep={Triangulate:n.triangulate}}(We);var Zn=Object.freeze(t({__proto__:null,default:We},[We]))?We||globalThis.poly2tri:{},Hn=Zn.SweepContext,Kn=Zn.Point,$n=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;e(this,t),this.stride=n}return r(t,[{key:"sort",value:function(t,e){return this.sortArrayPart(t,0,t.length-this.stride,e),t}},{key:"partition",value:function(t,e,n,r){for(var i=t[n],o=t[n+1],a=e-this.stride,s=e;s<n;s+=2)r?r(i,o,t[s],t[s+1])&&(a+=this.stride,this.swap(t,a,s)):(i>t[s]||i==t[s]&&o>t[s+1])&&(a+=this.stride,this.swap(t,a,s));return this.swap(t,a+this.stride,n),a+this.stride}},{key:"swap",value:function(t,e,n){var r=t[e],i=t[e+1];return t[e]=t[n],t[e+1]=t[n+1],t[n]=r,t[n+1]=i,t}},{key:"sortArrayPart",value:function(t,e,n,r){if(e<n){var i=this.partition(t,e,n,r);this.sortArrayPart(t,e,i-this.stride,r),this.sortArrayPart(t,i+this.stride,n,r)}}}]),t}();function Qn(t,e,n,r,i,o){return(n-t)*(o-e)-(r-e)*(i-t)}function tr(t,e,n,r,i,o){var a=t-n,s=i-n,u=a*(o-r)-s*(e-r);u*=u;var c=(a=i-n)*a+(s=o-r)*s;return c>0?Math.sqrt(u/c):Math.sqrt((n-t)*(n-t)+(r-e)*(r-e))}var er=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Float32Array;e(this,t),this.ArrayType=n,this.quickSort=new $n}return r(t,[{key:"monotoneChain",value:function(t){if(t.length<=0)return new this.ArrayType;this.quickSort.sort(t);for(var e=new this.ArrayType(t.length),n=0,r=0;r<t.length;r+=2){for(;n>=4&&Qn(e[n-4],e[n-3],e[n-2],e[n-1],t[r],t[r+1])<=0;)n-=2;e[n]=t[r],e[n+1]=t[r+1],n+=2}e=e.slice(0,n);var i,o=new this.ArrayType(t.length);n=0;for(var a=t.length-2;a>=0;a-=2){for(;n>=4&&Qn(o[n-4],o[n-3],o[n-2],o[n-1],t[a],t[a+1])<=0;)n-=2;o[n]=t[a],o[n+1]=t[a+1],n+=2}if(o=o.slice(0,n-2),this.ArrayType==Float32Array){var s=o.length+e.length;(i=Float32Array.createSharedInstance(s)).set(o),i.set(e,o.length)}else i=o.concat(e);return i}}]),t}();function nr(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return rr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rr(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function rr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ir=function(){function t(n){var r,i=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e(this,t),!(n instanceof _e))throw new Error("Expected shape type is Path. Use createInstance or createSharedInstance Polygon methods to allocate instance.");if(o.some((function(t){return!(t instanceof _e)})))throw new Error("Expected hole type is Path. Use createInstance or createSharedInstance Polygon methods to allocate instance.");this.holesDirection=t.PointsDirection.CLOCKWISE,Object.defineProperty(this,"shape",{value:n,enumerable:!0}),Object.defineProperty(this,"holes",{value:o,enumerable:!0}),Object.defineProperty(this,"contours",{value:[n].concat(ke(o)),enumerable:!0}),Object.defineProperty(this,"ArrayType",{value:n instanceof Fe?Float32Array:Array}),Object.defineProperty(this,"bounds",{get:function(){return je.ofPolygon(i)},enumerable:!0}),Object.defineProperty(this,"vertices",{get:function(){return r||(r=i.triangulate()),r},set:function(t){return r=t},enumerable:!0}),Object.defineProperty(this,"verticesValue",{get:function(){return r}})}return r(t,[{key:"clone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.shape.clone(e),r=this.holes.map((function(t){return t.clone(e)})),i=new t(n,r);return this.verticesValue&&(i.vertices=this.vertices.slice()),i}},{key:"fit",value:function(t){var e,n=this.bounds,r=t.width/n.width,i=t.height/n.height,o=r>0&&i>0?Math.min(r,i):Math.max(r,i),a=nr(this.contours);try{for(a.s();!(e=a.n()).done;)for(var s=e.value,u=0;u<s.length;u++)s.setPointX(u,s.getPointX(u)*o),s.setPointY(u,s.getPointY(u)*o)}catch(t){a.e(t)}finally{a.f()}}},{key:"center",value:function(){var t,e=this.bounds,n=nr(this.contours);try{for(n.s();!(t=n.n()).done;)for(var r=t.value,i=0;i<r.length;i++)r.setPointX(i,r.getPointX(i)-e.center.x),r.setPointY(i,r.getPointY(i)-e.center.y)}catch(t){n.e(t)}finally{n.f()}}},{key:"transform",value:function(t){this.contours.forEach((function(e){return e.transform(t)}))}},{key:"intersects",value:function(e){if(!(e instanceof t))throw new Error("Expected 'poly' type is Polygon");for(var n=this.shape,r=e.shape,i=0;i<2;i++)for(var o=0==i?n:r,a=0;a<o.length;a++){for(var s=a+1==o.length?0:a+1,u=o.getPointX(a),c=o.getPointY(a),l=o.getPointX(s),h=o.getPointY(s)-c,f=u-l,p=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,y=0;y<n.length;y++){var v=h*n.getPointX(y)+f*n.getPointY(y);v<p&&(p=v),v>d&&(d=v)}for(var m=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,b=0;b<r.length;b++){var x=h*r.getPointX(b)+f*r.getPointY(b);x<m&&(m=x),x>g&&(g=x)}if(d<m||g<p)return!1}return!0}},{key:"triangulate",value:function(){var t,e,n=[],r=nr(this.contours);try{for(r.s();!(t=r.n()).done;){for(var i=t.value,o=[],a=0;a<i.length;a++){var s=new Kn(i.getPointX(a),i.getPointY(a));if(a>0){if(o.last.x==s.x&&o.last.y==s.y)continue;if(a==i.length-1&&o.first.x==s.x&&o.first.y==s.y)continue}o.push(s)}n.push(o)}}catch(t){r.e(t)}finally{r.f()}try{e=new Hn(n.shift())}catch(t){return console.error(t),new Float32Array}for(var u=0,c=n;u<c.length;u++){var l=c[u];try{e.addHole(l)}catch(t){return console.error(t),new Float32Array}}try{e.triangulate()}catch(t){return console.warn(t),new Float32Array}var h,f=e.getTriangles(),p=Float32Array.createSharedInstance(6*f.length),d=0,y=nr(f);try{for(y.s();!(h=y.n()).done;){var v,m=nr(h.value.getPoints());try{for(m.s();!(v=m.n()).done;){var g=v.value;p[d++]=g.x,p[d++]=g.y}}catch(t){m.e(t)}finally{m.f()}}}catch(t){y.e(t)}finally{y.f()}return p}},{key:"convex",value:function(){return this.buildConvex.convex(this.shape.points)}},{key:"union",value:function(t){var e=Array.of.apply(Array,ke(this.shape.points).concat(ke(t.shape.points)));return this.buildConvex(e)}},{key:"buildConvex",value:function(e){this.convexHullProducer||(this.convexHullProducer=new er(this.ArrayType));var n=this.convexHullProducer.monotoneChain(e);return this.ArrayType==Float32Array?t.createSharedInstance(n):t.createInstance(n)}},{key:"simplify",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1;if(e<=0)throw new Error("epsilon expected value > 0");this.epsilon=e;var n,r=this.simplifyPath(this.shape),i=[],o=nr(this.holes);try{for(o.s();!(n=o.n()).done;){var a=n.value,s=this.simplifyPath(a);s.length>0&&i.push(s)}}catch(t){o.e(t)}finally{o.f()}return this.shape instanceof Fe?t.createSharedInstance(r,i):t.createInstance(r,i)}},{key:"simplifyPath",value:function(t){if(t.length<3)return t.points;var e=Array.of.apply(Array,ke(t.points).concat([t.getPointX(0),t.getPointY(0)])),n=this.simplifyPolyline(e);return n.length<8?e.slice(0,e.length-2):n.slice(0,n.length-2)}},{key:"simplifyPolyline",value:function(t){if(t.length<4)return t;for(var e=0,n=0,r=2;r<t.length-2;r+=2){var i=tr(t[r],t[r+1],t[0],t[1],t[t.length-2],t[t.length-1]);i>e&&(n=r,e=i)}if(e>this.epsilon){var o=this.simplifyPolyline(t.slice(0,n+2)),a=this.simplifyPolyline(t.slice(n,t.length));return o.concat(a.slice(2,a.length))}return[t[0],t[1],t[t.length-2],t[t.length-1]]}},{key:"toSVGPath",value:function(){return this.contours.map((function(t){return t.toSVGPath()})).join(" ")}},{key:"toJSON",value:function(){return{type:"Polygon",shape:this.shape.toJSON(),holes:this.holes.map((function(t){return t.toJSON()})),holesDirection:this.holesDirection.name,vertices:this.verticesValue}}}],[{key:"fromJSON",value:function(e){if("Polygon"!=e.type)throw new Error("Polygon deserialization failed. JSON type is ".concat(e.type,", expected Polygon."));var n=new t("SharedPath"==e.shape.type?Fe.fromJSON(e.shape):Ce.fromJSON(e.shape),e.holes.map((function(t){return"SharedPath"==t.type?Fe.fromJSON(t):Ce.fromJSON(t)})));return n.holesDirection=t.PointsDirection[e.holesDirection],n.vertices=e.vertices,n}},{key:"fromRect",value:function(e){return t.createInstance([e.left,e.top,e.right,e.top,e.right,e.bottom,e.left,e.bottom,e.left,e.top])}},{key:"createInstance",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return new t(new Ce(e),n.map((function(t){return new Ce(t)})))}},{key:"createSharedInstance",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=new t(new Fe(e),n.map((function(t){return new Fe(t)})));return Object.defineProperty(r,"encoding",{get:function(){return r.shape.encoding},set:function(t){r.contours.forEach((function(e){return e.encoding=t}))},enumerable:!0}),r}}]),t}();Object.defineEnum(ir,"PointsDirection",["CLOCKWISE","COUNTERCLOCKWISE"]);var or=function(){function t(){var n=this;e(this,t),this.keepAllData=!1,Object.defineProperty(this,"allData",{get:function(){if(!n.keepAllData)throw new Error("All data is not accumulated. By default keepAllData property is false.");return n.path||(n.path=new n.constructor.ARRAY_TYPE),n.getOutput(n.path,t.OutputType.ALL_DATA)},enumerable:!0})}return r(t,[{key:"build",value:function(e){var n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.OutputType.PROCESSOR,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];switch(i){case t.OutputType.ADDITION:n=this.add(e,o);break;case t.OutputType.PREDICTION:n=this.predict(e);break;case t.OutputType.PROCESSOR:this.reset(),n=this.buildImpl(e,i);break;default:throw new Error("Unexpected OutputType found. Allowed type is oneof(ADDITION, PREDICTION, PROCESSOR)")}i!=t.OutputType.PREDICTION&&(this.keepAllData&&(this.path||(this.path=new this.constructor.ARRAY_TYPE),n instanceof ir?this.path.push(n):(r=this.path).push.apply(r,ke(n))));return this.debug&&console.log(this.constructor.name,i.name,o,n),this.getOutput(n,i)}},{key:"add",value:function(e){return this.buildImpl(e,t.OutputType.ADDITION)}},{key:"predict",value:function(e){return this.buildImpl(e,t.OutputType.PREDICTION)}},{key:"buildImpl",value:function(t){throw new Error("Abstract method buildImpl(input) of DataSequenceProcessor should be implemented")}},{key:"getOutput",value:function(t,e){return t}},{key:"reset",value:function(){this.path&&(this.path=new this.constructor.ARRAY_TYPE)}}]),t}();function ar(t){var e="function"==typeof Map?new Map:void 0;return(ar=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return J(t,arguments,c(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),i(r,t)})(t)}function sr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=c(t);if(e){var i=c(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u(this,n)}}function ur(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return cr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return cr(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function cr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function lr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=c(t);if(e){var i=c(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u(this,n)}}he(or,"ARRAY_TYPE",Array),Object.defineEnum(or,"OutputType",["ADDITION","PREDICTION","ALL_DATA","PROCESSOR"]);var hr=function(t){o(i,t);var n=lr(i);function i(){var t,r;e(this,i);for(var o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];return t=n.call.apply(n,[this].concat(a)),Object.defineProperty(s(t),"encoding",{get:function(){return r},set:function(e){r=e,t.forEach((function(t){return t.encoding=e}))},enumerable:!0}),t}return r(i,[{key:"intersects",value:function(t){t instanceof ir&&(t=[t]);var e,n=ur(this);try{for(n.s();!(e=n.n()).done;){var r,i=e.value,o=ur(t);try{for(o.s();!(r=o.n()).done;){var a=r.value;if(i.intersects(a))return{poly1:i,poly2:a}}}catch(t){o.e(t)}finally{o.f()}}}catch(t){n.e(t)}finally{n.f()}return null}},{key:"toJSON",value:function(){var t=ze(c(i.prototype),"toJSON",this).call(this);return t.type="InkPath2D",t}}],[{key:"fromJSON",value:function(t){if("InkPath2D"!=t.type)throw new Error("InkPath2D deserialization failed. JSON type is ".concat(t.type,", expected InkPath2D."));return J(i,ke(t.polygons.map((function(t){return ir.fromJSON(t)}))))}}]),i}(function(t,n){o(a,t);var i=sr(a);function a(){var t;e(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];if(t=i.call.apply(i,[this].concat(r)),r.some((function(t){return!(t instanceof ir)})))throw new Error("Expected data item type is Polygon");return Object.defineProperty(s(t),"bounds",{get:function(){var e;return t.length>0&&(t.forEach((function(t){return e=t.bounds.union(e)})),e=e.ceil()),e},enumerable:!0}),Object.defineProperty(s(t),"vertices",{get:function(){return t.triangulate()},enumerable:!0}),t}return r(a,[{key:"clone",value:function(){return J(this.constructor,ke(this.map((function(t){return t.clone()}))))}},{key:"push",value:function(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];if(n.some((function(t){return!(t instanceof ir)})))throw new Error("Expected data item type is Polygon");(t=ze(c(a.prototype),"push",this)).call.apply(t,[this].concat(n))}},{key:"triangulate",value:function(){var t;return(t=Float32Array.createSharedInstance()).concat.apply(t,ke(this.map((function(t){return t.vertices}))))}},{key:"transform",value:function(t){this.forEach((function(e){return e.transform(t)}))}},{key:"toJSON",value:function(){return{type:"PolygonArray",polygons:this.map((function(t){return t.toJSON()}))}}}],[{key:n,get:function(){return Array}},{key:"fromJSON",value:function(t){if("PolygonArray"!=t.type)throw new Error("PolygonArray deserialization failed. JSON type is ".concat(t.type,", expected PolygonArray."));return J(a,ke(t.polygons.map((function(t){return ir.fromJSON(t)}))))}}]),a}(ar(Array),Symbol.species));function fr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=c(t);if(e){var i=c(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u(this,n)}}var pr,dr=function(t){o(i,t);var n=fr(i);function i(t){var r;return e(this,i),(r=n.call(this)).brush=t,r}return r(i,[{key:"buildImpl",value:function(t){return this.generatePolygons(t)}},{key:"generatePolygons",value:function(t){var e=new hr;if(!t)return e;for(var n=0;n<t.length;n++){var r=t.getPoint(n),i=this.applyBrush(r);e.push(i)}return e}},{key:"applyBrush",value:function(t){for(var e=this.createTransform(t),n=this.brush.selectShape(e.maxScale).shape,r=Float32Array.createSharedInstance(2*n.length),i=0;i<n.length;i++){var o=i*n.stride,a=Mt(n.getPointX(i),n.getPointY(i),0,1);jt(a,a,e),r[o]=a[0]/a[3],r[o+1]=a[1]/a[3]}return ir.createSharedInstance(r)}},{key:"createTransform",value:function(t){if(isNaN(t.size))throw new Error("Size information not found.");var e,n,r,i,o,a,s,u,c,l,h,f,p,d=rt(),y=t.size*t.scaleX,v=t.size*t.scaleY,m=t.size*t.scaleZ||0,g=Math.max(y,v,m);return at(d,d,ct(t.x,t.y,t.z||0)),e=d,n=d,r=t.rotation,i=Math.sin(r),o=Math.cos(r),a=n[0],s=n[1],u=n[2],c=n[3],l=n[4],h=n[5],f=n[6],p=n[7],n!==e&&(e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=a*o+l*i,e[1]=s*o+h*i,e[2]=u*o+f*i,e[3]=c*o+p*i,e[4]=l*o-a*i,e[5]=h*o-s*i,e[6]=f*o-u*i,e[7]=p*o-c*i,at(d,d,ct(t.offsetX,t.offsetY,t.offsetZ||0)),function(t,e,n){var r=n[0],i=n[1],o=n[2];t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(d,d,ct(y,v,m)),d.maxScale=g,d}}]),i}(or);he(dr,"ARRAY_TYPE",hr);var yr=function(){function t(){if(e(this,t),pr)throw new Error("URIResolver instance already available");pr=this,this.init()}return r(t,[{key:"init",value:function(){throw new Error("URIResolver: init should be implemented")}},{key:"get",value:function(t){return this[t]}},{key:"register",value:function(t,e){this[t]=e}},{key:"resolve",value:function(t){var e;if(t.includes("?")){var n=this[t.split("?")[0]];if(n){var r=t.split("?")[1],i=[];r.split("&").forEach((function(t){var e=t.split("=")[1],n=parseFloat(e);isFinite(n)?e=n:"true"==e?e=!0:"false"==e&&(e=!1),i.push(e)})),e=function(){return n.apply(void 0,ke(Array.from(arguments).concat(i)))}}}else e=this[t];if(!e)throw new Error("Failed to resolve ".concat(t));return e}}]),t}();Object.defineProperty(yr,"instance",{get:function(){return pr}});var vr=function(){function t(n,r){e(this,t),this.name=n,!n||Oe.isValidURL(n)||t.repetitionsCache.has(n)||(t.repetitionsCache.add(n),console.warn("The string ".concat(n," is not a well formed URI"))),Object.defineProperty(this,"value",{get:function(){if(!r){if(!this.name)throw new Error("Resource descriptor identifier not found. Cannot resolve resource content.");if("function"==typeof this.resolve&&(r=this.resolve(this.name)),!r){if(!yr.instance)throw new Error("Resource URI ".concat(this.name," cannot be resolved. URIResolver not implemented yet. Please implement and instantiate."));r=yr.instance.resolve(this.name)}if(!r)throw new Error("Resource URI ".concat(this.name," cannot be resolved. Please provide resource definition in URIResolver init implementation."))}return r},set:function(t){r=t},enumerable:!0})}return r(t,[{key:"toJSON",value:function(){var t=this.value;return ArrayBuffer.isTypedArray(t)?t=Re.encode(t,this.encoding):"function"==typeof t&&(t=t()),{name:this.name,value:t}}}],[{key:"fromJSON",value:function(e){var n=e.value;return Re.isTypedArrayData(n)&&(n=Re.decode(n)),new t(e.name,n)}},{key:"getInstance",value:function(e,n){return new t(n,e)}}]),t}();he(vr,"repetitionsCache",new Set);var mr=function(){function t(n){e(this,t),Oe.isValidURL(n)||(vr.repetitionsCache.has(n)||(vr.repetitionsCache.add(n),console.warn("Brush URI ".concat(n," is not a well formed URI"))),n=this.constructor.onInvalidName(n)),Object.defineProperty(this,"id",{value:n}),Object.defineProperty(this,"uri",{value:n}),Object.defineProperty(this,"name",{value:n,enumerable:!0})}return r(t,[{key:"toJSON",value:function(){throw new Error("Brush.toJSON() should be implemented")}}],[{key:"fromJSON",value:function(t){throw new Error("static Brush.fromJSON() should be implemented")}},{key:"onInvalidName",value:function(t){return t}}]),t}(),gr=function(){function t(){e(this,t)}return r(t,null,[{key:"createCircle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.defaults.CIRCLE_PRECISION,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.defaults.CIRCLE_RADIUS,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0};return t.createEllipse(e,n,n,r)}},{key:"createEllipse",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.defaults.ELLIPSE_PRECISION,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.defaults.ELLIPSE_RADIUS_X,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.defaults.ELLIPSE_RADIUS_Y,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:0,y:0},o=[],a=2*Math.PI/e;if(n<=0)throw new Error("Invalid radius x found ".concat(n," > 0"));if(r<=0)throw new Error("Invalid radius y found ".concat(r," > 0"));for(var s=0;s<e;s++){var u=s*a,c=n*Math.cos(u),l=r*Math.sin(u);o.push(i.x+c,i.y+l)}return Float32Array.createSharedInstance(o)}},{key:"createStar",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.defaults.STAR_POINTS,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.defaults.STAR_INTERNAL_RADIUS,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.defaults.STAR_RADIUS,i=[];if(r<=0)throw new Error("Invalid radius found ".concat(r," > 0"));if(n<=0)throw new Error("Invalid internal radius found ".concat(n," > 0"));if(n>r)throw new Error("Invalid internal radius found 0 < ".concat(n," < ").concat(r));for(var o=2*Math.PI/e,a=0;a<e;a++){var s=a*o,u=r*Math.cos(s),c=r*Math.sin(s),l=n*Math.cos(s+o/2),h=n*Math.sin(s+o/2);i.push(u,c,l,h)}return Float32Array.createSharedInstance(i)}}]),t}();he(gr,"defaults",{CIRCLE_PRECISION:20,CIRCLE_RADIUS:.5,ELLIPSE_PRECISION:20,ELLIPSE_RADIUS_X:.5,ELLIPSE_RADIUS_Y:.25,STAR_POINTS:5,STAR_RADIUS:.5,STAR_INTERNAL_RADIUS:.25});var br=function(){function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e(this,t),this.size=r,Object.defineProperty(this,"descriptor",{value:{shape:void 0},enumerable:!0}),Object.defineProperty(this,"shape",{get:function(){if(!n){if("function"==typeof(n=this.descriptor.shape.value)&&(n=n()),(Array.isArray(n)||n instanceof Float32Array)&&(n=ir.createSharedInstance(n)),!(n instanceof ir))throw new Error("Expected shape type is Polygon");t.fitShape(n)}return n},set:function(e){if(!e)throw new Error("BrushPrototype: shape not found");"string"==typeof e?e=new vr(e):e instanceof ir||e instanceof Float32Array||Array.isArray(e)?e=vr.getInstance(e):e instanceof vr||(e=new vr(e.name,e.value)),n=null,this.descriptor.shape=e,this.descriptor.shape.resolve=t.resolve},enumerable:!0}),this.shape=n}return r(t,[{key:"toJSON",value:function(){return this.shape.encoding=this.encoding,{shape:{name:this.descriptor.shape.name,value:this.shape.toJSON()},size:this.size}}}],[{key:"fromJSON",value:function(e){return new t({name:e.shape.name,value:ir.fromJSON(e.shape.value)},e.size)}},{key:"create",value:function(e){for(var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e,o=arguments.length,a=new Array(o>2?o-2:0),s=2;s<o;s++)a[s-2]=arguments[s];switch(e){case t.Type.CIRCLE:n=gr.createCircle.apply(gr,a),i+="?precision=".concat(a[0]||gr.defaults.CIRCLE_PRECISION,"&radius=").concat(a[1]||gr.defaults.CIRCLE_RADIUS);break;case t.Type.ELLIPSE:n=gr.createEllipse.apply(gr,a),i+="?precision=".concat(a[0]||gr.defaults.ELLIPSE_PRECISION,"&radiusX=").concat(a[1]||gr.defaults.ELLIPSE_RADIUS_X,"&radiusY=").concat(a[2]||gr.defaults.ELLIPSE_RADIUS_Y);break;case t.Type.STAR:n=gr.createStar.apply(gr,a),i+="?points=".concat(a[0]||gr.defaults.STAR_POINTS,"&internalRadius=").concat(a[1]||gr.defaults.STAR_INTERNAL_RADIUS,"&radius=").concat(a[2]||gr.defaults.STAR_RADIUS);break;default:console.error("Brush2D: createShape fails with ".concat(e," type"))}return new t({name:i,shape:n},r)}},{key:"resolve",value:function(e){var n,r=e.split("?"),i=r.first;if(Object.values(t.Type).includes(i)){var o=r.last.split("&"),a={};switch(o.forEach((function(t){a[t.substring(0,t.indexOf("="))]=t.substring(t.indexOf("=")+1)})),i){case t.Type.CIRCLE:var s=a.precision?parseInt(a.precision):void 0,u=a.radius?parseFloat(a.radius):1;n=gr.createCircle(s,u);break;case t.Type.ELLIPSE:var c=a.precision?parseInt(a.precision):void 0,l=a.radiusX?parseFloat(a.radiusX):void 0,h=a.radiusY?parseFloat(a.radiusY):void 0;n=gr.createEllipse(c,l,h);break;case t.Type.STAR:var f=a.points?parseInt(a.points):void 0,p=a.radius?parseFloat(a.radius):void 0,d=a.internalRadius?parseFloat(a.internalRadius):void 0;n=gr.createStar(f,d,p);break;default:console.error("Brush2D: createShape fails with ".concat(i," type"))}}return n}},{key:"fitShape",value:function(e){if(!(e instanceof ir))throw new Error("Expected shape type is Polygon");e.center(),e.fit(t.SHAPE_FRAME)}}]),t}();he(br,"SHAPE_FRAME",new je(-.5,-.5,1,1)),br.Type={ELLIPSE:"will://brush/3.0/shape/Ellipse",CIRCLE:"will://brush/3.0/shape/Circle",STAR:"will://brush/3.0/shape/Star"};Object.defineProperty(globalThis,"DIGITAL_INK_ENV",{value:"AUTO",enumerable:!0,configurable:!0});var xr={version:"1.4.2"};function Pr(t){return new Promise((function(e,n){var r,i=new Image;i.crossOrigin="anonymous",i.onload=function(){if(xr.type2D==xr.Type2D.OFFSCREEN){var t=new OffscreenCanvas(i.width,i.height);t.getContext("2d").drawImage(i,0,0),e(t)}else r&&URL.revokeObjectURL(r),e(i)},i.onerror=n,"string"==typeof t?i.src=t:xr.type2D==xr.Type2D.OFFSCREEN?t instanceof Uint8Array?i.src=Buffer.from(t):t instanceof OffscreenCanvas?e(t):i.src=t:(t instanceof Uint8Array&&(t.byteLength!=t.buffer.byteLength&&(t=t.slice()),t=t.buffer),t instanceof ArrayBuffer&&(t=new Blob([t],{type:"image/png"})),r=URL.createObjectURL(t),i.src=r)}))}function wr(t){return Er.apply(this,arguments)}function Er(){return(Er=Z($.mark((function t(e){var n;return $.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"!=typeof e&&"undefined"!=typeof createImageBitmap){t.next=6;break}return t.next=3,Pr(e);case 3:n=t.sent,t.next=15;break;case 6:if(!(e instanceof ArrayBuffer||e instanceof Uint8Array)){t.next=12;break}return t.next=9,createImageBitmap(new Blob([e],{type:"image/png"}));case 9:n=t.sent,t.next=15;break;case 12:return t.next=14,createImageBitmap(e);case 14:n=t.sent;case 15:return t.abrupt("return",n);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Sr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=c(t);if(e){var i=c(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u(this,n)}}Object.defineEnum(xr,"Type",["WEB","WORKER","NODE","SHELL"]),Object.defineEnum(xr,"Type2D",["SCREEN","OFFSCREEN"]),Object.defineEnum(xr,"TypeGL",["WEB","STACK"]),function(t){var e,n="BROWSER"!=DIGITAL_INK_ENV&&"object"===("undefined"==typeof process?"undefined":a(process))&&"function"==typeof require;e="object"===("undefined"==typeof window?"undefined":a(window))?"WEB":"function"==typeof importScripts?"WORKER":n?"NODE":"SHELL";var r="undefined"==typeof OffscreenCanvas?"OFFSCREEN":"SCREEN",i="undefined"==typeof WebGLRenderingContext?"STACK":"WEB";Object.defineProperty(xr,"commonJS",{value:n,enumerable:!0}),Object.defineProperty(xr,"type",{value:xr.Type[e],enumerable:!0}),Object.defineProperty(xr,"type2D",{value:xr.Type2D[r],enumerable:!0}),Object.defineProperty(xr,"typeGL",{value:xr.TypeGL[i],enumerable:!0})}();var kr=function(t){o(a,t);var n,i=Sr(a);function a(t,n,r){var o,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return e(this,a),o=i.call(this,t),isFinite(r)&&(u=r,r=void 0),u<=0&&(console.warn("Invalid spacing found ".concat(u,". It should be positive number.")),u=1),Object.defineProperty(s(o),"shape",{get:function(){return n},set:function(t){if(t instanceof Float32Array&&(t=new br(t)),t instanceof br&&(t=[t]),t.some((function(t){return!(t instanceof br)})))throw console.warn(t),new Error("Brush2D: Invalid shape found");t.sort(Oe.comparator({sortBy:"size",sortOrder:"asc"})),n=t},enumerable:!0}),o.shape=n,o.fill=r,o.spacing=u,o}return r(a,[{key:"configure",value:(n=Z($.mark((function t(e){var n;return $.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.pattern&&this.fill){t.next=2;break}return t.abrupt("return");case 2:if(e instanceof CanvasRenderingContext2D||e instanceof OffscreenCanvasRenderingContext2D){t.next=4;break}throw new Error("ctx is not instance of CanvasRenderingContext2D or OffscreenCanvasRenderingContext2D");case 4:return t.next=6,wr(this.fill);case 6:n=t.sent,this.pattern=e.createPattern(n,"repeat");case 8:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"selectShape",value:function(t){for(var e,n=1;n<this.shape.length;n++)if(this.shape[n].size>t){e=this.shape[n-1];break}return e||(e=this.shape.last),e.shape}},{key:"toJSON",value:function(){var t=this;return{type:"Brush2D",name:this.name,spacing:this.spacing,shape:this.shape.map((function(e){return e.encoding=t.encoding,e.toJSON()}))}}}],[{key:"fromJSON",value:function(t){var e=1==t.shape.length?br.fromJSON(t.shape[0]):t.shape.map((function(t){return br.fromJSON(t)}));return new a(t.name,e,t.spacing)}}]),a}(mr);function Or(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=c(t);if(e){var i=c(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u(this,n)}}var Ir,Mr,_r,Tr,Ar,Cr,Rr,Nr,Fr,Dr,jr,Lr,Br,zr,Yr,Xr,Wr,Vr=(Ir=0,Mr=-.5,_r=1,Tr=-.5,Ar=1,Cr=0,Rr=-2.5,Nr=1.5,Fr=0,Dr=.5,jr=2,Lr=-1.5,Br=0,zr=0,Yr=-.5,Xr=.5,(Wr=new et(16))[0]=Ir,Wr[1]=Mr,Wr[2]=_r,Wr[3]=Tr,Wr[4]=Ar,Wr[5]=Cr,Wr[6]=Rr,Wr[7]=Nr,Wr[8]=Fr,Wr[9]=Dr,Wr[10]=jr,Wr[11]=Lr,Wr[12]=Br,Wr[13]=zr,Wr[14]=Yr,Wr[15]=Xr,Wr),Ur=function(t){o(i,t);var n=Or(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e(this,i),(t=n.call(this)).calculateDerivates=r,t.keepSplineParameters=o,t.state={lastPointPosition:void 0,lastPointSize:0},t}return r(i,[{key:"initState",value:function(t){var e=this;this.state.layout={},t.layout.forEach((function(t,n){e.state.layout[t.name]={index:n,polynomials:It()}})),this.keepSplineParameters&&(this.state.splineParameters=[]),this.splineLayout=t.layout,this.pathPointProps=Object.clone(t.pointProps),this.scattering&&(this.pathPointProps.scattering=this.scattering),this.layout=this.calculateDerivates?t.layout.concat([we.Property.D_X,we.Property.D_Y]):t.layout,this.state.ready=!0}},{key:"predict",value:function(t){if(!t)return[];this.state.ready||this.initState(t);var e=Object.clone(this.state);delete this.state.splineParameters,this.resetState();var n=this.discretize(t);return this.state=e,n}},{key:"buildImpl",value:function(t){return t?(this.state.ready||this.initState(t),this.discretize(t)):[]}},{key:"getOutput",value:function(t,e){if(0!=t.length){var n=e==i.OutputType.ALL_DATA?void 0:this.state.splineParameters;return n&&(n=n.slice()),new Xe(this.layout,t,this.pathPointProps,n)}}},{key:"discretize",value:function(t){throw new Error("This method is abstract and should be implemented")}},{key:"storeLastPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.state.lastPointPosition=new fe(this.getPropValue(we.Property.X,t,e),this.getPropValue(we.Property.Y,t,e),this.getPropValue(we.Property.Z,t,e)),this.state.lastPointSize=this.getPropValue(we.Property.SIZE,t,e)}},{key:"getPropValue",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.state.layout[t.name]?e[n+this.state.layout[t.name].index]:void 0}},{key:"calculatePolynomials",value:function(t,e){var n=this,r=t.points,i=this.splineLayout.length*(e+0),o=this.splineLayout.length*(e+1),a=this.splineLayout.length*(e+2),s=this.splineLayout.length*(e+3);this.splineLayout.forEach((function(t,e){var u=Mt(r[i+e],r[o+e],r[a+e],r[s+e]);jt(n.state.layout[t.name].polynomials,u,Vr)}))}},{key:"calculateInterpolatedPoint",value:function(t,e,n){var r=this;this.initState(t);var i=new we(0,0,this.splineLayout.includes(we.Property.Z)?0:void 0),o=Mt(1,n,n*n,n*n*n);return this.calculatePolynomials(t,e),this.splineLayout.forEach((function(t){var e=Dt(r.state.layout[t.name].polynomials,o);i[Oe.getPropName(t.name)]=e})),i}},{key:"samplePoint",value:function(t){var e=this,n=[],r=Mt(1,t,t*t,t*t*t);return this.splineLayout.forEach((function(t){var i=Dt(e.state.layout[t.name].polynomials,r);n.push(i)})),this.calculateDerivates&&(n.push(this.getDerivativeOf(this.state.layout.X.polynomials,r)),n.push(this.getDerivativeOf(this.state.layout.Y.polynomials,r))),n}},{key:"getDerivativeOf",value:function(t,e){return Dt(Mt(t[1],2*t[2],3*t[3],0),e)}},{key:"keepSegmentT",value:function(t,e){this.state.splineParameters&&this.state.splineParameters.push(i.defineParameter(t,e))}},{key:"resetState",value:function(){}},{key:"reset",value:function(){ze(c(i.prototype),"reset",this).call(this),this.state.ready=!1,this.state.lastPointPosition=void 0,this.state.lastPointSize=0,delete this.state.splineParameters}}],[{key:"defineParameter",value:function(t,e){return t>0&&0==e?{index:t-1,t:1}:{index:t,t:e}}}]),i}(or);function qr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=c(t);if(e){var i=c(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u(this,n)}}var Jr=function(t){o(i,t);var n=qr(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,o=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;return e(this,i),(t=n.call(this,o,a)).spacing=r,t}return r(i,[{key:"split",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=this.spacing;this.spacing=1,this.splitCount=e;var r=this.build(t);return this.spacing=n,delete this.splitCount,r}},{key:"discretize",value:function(t){for(var e=[],n=this.splitCount,r=Math.max(1,10*(this.spacing>1?1:this.spacing)),i=0;i<t.segmentsCount;i++){if(this.calculatePolynomials(t,i),isNaN(this.splitCount)){var o=t.getPoint(i+1),a=t.getPoint(i+2),s=$t(o.value,a.value),u=this.pathPointProps.size;this.state.layout.SIZE&&(u=Math.min(o.size,a.size)),n=Math.floor(r*(s/u)/this.spacing)+1}for(var c=1/n,l=0;l<=n;l++){var h=!this.state.lastPointPosition,f=l/n;if(0==i&&f<t.ts){if(!(f+c>=t.ts))continue;f=t.ts,h=this.spacing<=1}if(i==t.segmentsCount-1&&f>=t.tf){if(!(f<t.tf+c))continue;f=t.tf,h=this.lastSegment&&this.spacing<=1}if(!(i>0&&0==f)){var p=this.samplePoint(f);if(!h&&this.state.lastPointPosition){var d=new fe(this.getPropValue(we.Property.X,p),this.getPropValue(we.Property.Y,p),this.getPropValue(we.Property.Z,p)),y=this.state.lastPointPosition.vec.squaredDistance(this.state.lastPointPosition.value,d.value),v=(this.state.layout.SIZE?(this.state.lastPointSize+p[this.state.layout.SIZE.index])/2:this.pathPointProps.size)*this.spacing;h=y>=v*v}h&&(e.push.apply(e,ke(p)),this.storeLastPoint(p),this.keepSegmentT(i,f))}}}return this.state.splineParameters&&(0!=e.length&&this.state.splineParameters.first.t==t.ts||(e.unshift.apply(e,ke(this.samplePoint(t.ts))),this.state.splineParameters.unshift(Ur.defineParameter(0,t.ts))),this.state.splineParameters.last.t!=t.tf&&(e.push.apply(e,ke(this.samplePoint(t.tf))),this.state.splineParameters.push(Ur.defineParameter(t.segmentsCount-1,t.tf)))),e}}]),i}(Ur),Gr=function(){function t(n){var r=this;e(this,t),this.header=[],this.table=[],n.forEach((function(t){"string"==typeof t&&(t={name:t,title:t}),t.size=t.title.length,r.header.push(t)})),Object.defineProperty(this,"length",{get:function(){return r.table.length},enumerable:!0})}return r(t,[{key:"insert",value:function(t){this.table.push(t),this.header.forEach((function(e){var n=t[e.name];null!=n&&(e.size=Math.max(e.size,n.toString().length))}))}},{key:"build",value:function(){var t=this,e=[],n=this.header.length+1,r=[];return this.header.forEach((function(e){n+=e.size+2;var i=e.size-e.title.length,o=Math.floor(i/2),a=Math.ceil(i/2);r.push(t.getRepetedValue(o)+e.title+t.getRepetedValue(a))})),this.table.forEach((function(n){var r=[];t.header.forEach((function(e){var i=null==n[e.name]?"":n[e.name],o=e.size-i.toString().length;r.push(i+t.getRepetedValue(o))})),e.push(r)})),{delimiterLength:n,headerRow:r,content:e}}},{key:"getFormattedRow",value:function(t){var e="| ";return t.forEach((function(t){e+=t,e+=" | "})),e.trim()}},{key:"getRepetedValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ";return new Array(t+1).join(e)}},{key:"clear",value:function(){this.table.clear()}},{key:"toString",value:function(){var t=this,e="",n=this.build(),r=n.delimiterLength,i=n.headerRow,o=n.content;return e+=this.getRepetedValue(r,"="),e+="\n",e+=this.getFormattedRow(i),e+="\n",e+=this.getRepetedValue(r,"="),e+="\n",o.forEach((function(n){e+=t.getFormattedRow(n),e+="\n"})),e}}]),t}();function Zr(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Hr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Hr(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Hr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Kr=function(){function t(){e(this,t),this.interpolator=new Jr(.1,!1,!0)}return r(t,[{key:"build",value:function(t,e,n){this.context=t,this.path=n,this.holesPerStroke={},this.strokeHoles=[],e.sort(Oe.comparator({sortBy:"strokeID",sortOrder:"asc"},{sortBy:"segmentIndex",sortOrder:"asc"},{sortBy:"splineIndex",sortOrder:"asc"},{sortBy:"pointIndex",sortOrder:"asc"})),this.debug&&(this.table=new Gr([{name:"strokeID",title:"Stroke ID"},{name:"segmentIndex",title:"Segment Index"},{name:"splineIndex",title:"Spline Index"},{name:"pointIndex",title:"Point Index"},{name:"prevT",title:"Prev T"},{name:"t",title:"T Value"},{name:"nextT",title:"Next T"},{name:"ts",title:"Start T"},{name:"tf",title:"End T"},{name:"size",title:"Size"},{name:"hole",title:"HolePart"},{name:"nodeIndex",title:"Node Index"}]));var r,i=Zr(e);try{for(i.s();!(r=i.n()).done;){var o=r.value;this.isHolePart(o)?this.update(o):this.add(o),this.debug&&this.table.insert({strokeID:o.strokeID,segmentIndex:o.segmentIndex,splineIndex:o.splineIndex,pointIndex:o.pointIndex,prevT:o.prevT.toFixed(4),t:o.t.toFixed(4),nextT:o.nextT.toFixed(4),ts:o.spline.ts.toFixed(4),tf:o.spline.tf.toFixed(4),size:"".concat(o.bounds.width.toFixed(2)," / ").concat(o.bounds.height.toFixed(2)),hole:o.hole,nodeIndex:o.nodeIndex})}}catch(t){i.e(t)}finally{i.f()}return this.debug&&this.table.length>0&&console.log(this.table.toString()),this.narrow(),this.holesPerStroke}},{key:"add",value:function(t){this.strokeHoles=this.holesPerStroke[t.strokeID],this.strokeHoles||(this.strokeHoles=[],this.holesPerStroke[t.strokeID]=this.strokeHoles);var e=this.context.getNodes(t.strokeID).indexOf(t);this.strokeHoles.push({fromPointIndex:t.segmentIndex,toPointIndex:t.segmentIndex,fromTValue:t.prevT,toTValue:t.nextT,fromNodeIndex:e,toNodeIndex:e,strokeID:t.strokeID}),this.debug&&(t.hole=!1,t.nodeIndex=e)}},{key:"update",value:function(t){var e=this.strokeHoles.last;e.toPointIndex=t.segmentIndex,e.toTValue=t.nextT,e.toNodeIndex=this.context.getNodes(t.strokeID).indexOf(t),this.debug&&(t.hole=!0,t.nodeIndex=e.toNodeIndex)}},{key:"isHolePart",value:function(t){var e=this.strokeHoles.last;return!(!e||e.strokeID!=t.strokeID)&&(t.segmentIndex==e.toPointIndex&&t.prevT<=e.toTValue||t.segmentIndex==e.toPointIndex+1&&1==e.toTValue&&0==t.prevT)}},{key:"narrow",value:function(){for(var t=0,e=Object.values(this.holesPerStroke);t<e.length;t++){var n,r=Zr(e[t]);try{for(r.s();!(n=r.n()).done;){var i=n.value,o=this.context.getNodes(i.strokeID),a=o[i.fromNodeIndex],s=o[i.toNodeIndex],u={s:this.extractT(a,"s",a.prevT,a.nextT),f:this.extractT(s,"f",s.prevT,s.nextT)};a.ts=u.s,s.tf=u.f,i.fromTValue=u.s,i.toTValue=u.f}}catch(t){r.e(t)}finally{r.f()}}}},{key:"extractT",value:function(t,e,n,r){var i,o,a="s"==e?n:r;try{i=new Be(t.spline.layout,t.spline.points,t.spline.pointProps,n,r)}catch(t){return a}for(var s=this.interpolator.build(i),u=0;u<s.length;u++){var c=s.getPoint(u),l=this.context.getBrushApplier(t.strokeID).applyBrush(c);if(this.path.intersects(l)){if("s"==e){a=o;break}o=s.getPointT(u)}else if("s"==e)o=s.getPointT(u);else if(o){a=s.getPointT(u);break}}return a}}]),t}();function $r(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Qr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qr(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Qr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ti=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.Mode.WHOLE_STROKE;e(this,t),this.mode=n,this.operations=Promise.resolve(),this.holesBuilder=new Kr}var n;return r(t,[{key:"updateSegmentation",value:function(e){if(!this.context)throw new Error("Required spatial context not found");if(e&&0!=e.length){var n,r=[],i=!1,o=$r(e);try{for(o.s();!(n=o.n()).done;){var a=n.value,s=this.context.search(a.bounds);if(0!=s.length){var u,c=[],l=$r(s);try{for(l.s();!(u=l.n()).done;){var h=u.value;switch(h.depth){case t.SegmentationDepth.STROKE_BOUNDS:for(var f=[],p=this.context.getStroke(h.strokeID),d=this.context.getBrushApplier(p.id),y=0;y<p.segmentsCount;y++){var v=t.buildStrokeSegment(p.id,p.spline,y,d);f.push(v)}this.context.updateTree(h,f),c=c.concat(f),i=!0;break;case t.SegmentationDepth.STROKE_SEGMENT:for(var m=[],g=this.context.getBrushApplier(h.strokeID),b=this.context.distanceInterpolator.build(h.spline),x=g.build(b),P=this.buildShapeSegment(0,h.spline,b,x),w=0;w<b.length-1;w++){var E=this.buildSplineSegment(h,w,b,x,P);P=E.fPoint,m.push(E)}this.context.updateTree(h,m),c=c.concat(m),i=!0;break;case t.SegmentationDepth.SPLINE_SEGMENT:h.convex=this.context.convexHullChainProducer.build(h.shapesPath),h.shape=h.convex.first,h.depth=t.SegmentationDepth.CONVEX,i=!0;break;case t.SegmentationDepth.CONVEX:if(h.convex.intersects(a))if(this.mode==t.Mode.PARTIAL_STROKE){var S=[];S.push(this.buildPointSegment(h,0)),S.push(this.buildPointSegment(h,1)),this.context.updateTree(h,S),c=c.concat(S),i=!0}else r.push(h);break;case t.SegmentationDepth.SHAPE:r.push(h);break;default:throw new Error("Invalid node depth found: ".concat(h.depth))}}}catch(t){l.e(t)}finally{l.f()}if(c.length>0&&this.context.load(c),i){this.updateSegmentation(e);break}var k,O=$r(r);try{for(O.s();!(k=O.n()).done;){var I=k.value;this.nodes.add(I)}}catch(t){O.e(t)}finally{O.f()}this.context.tree.canvas&&this.context.tree.canvas.refresh()}}}catch(t){o.e(t)}finally{o.f()}}}},{key:"updateSegmentationAsync",value:(n=Z($.mark((function e(n){var r,i,o,a,s,u,c,l,h,f,p,d,y,v,m,g,b,x,P,w,E,S,k;return $.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.context){e.next=2;break}throw new Error("Required spatial context not found");case 2:if(n&&0!=n.length){e.next=4;break}return e.abrupt("return");case 4:r=!1,i=$r(n),e.prev=6,i.s();case 8:if((o=i.n()).done){e.next=69;break}if(a=o.value,0!=(s=this.context.search(a.bounds)).length){e.next=13;break}return e.abrupt("continue",67);case 13:u=[],c=$r(s),e.prev=15,c.s();case 17:if((l=c.n()).done){e.next=51;break}h=l.value,e.t0=h.depth,e.next=e.t0===t.SegmentationDepth.STROKE_BOUNDS?22:e.t0===t.SegmentationDepth.STROKE_SEGMENT?30:e.t0===t.SegmentationDepth.SPLINE_SEGMENT?39:e.t0===t.SegmentationDepth.CONVEX?43:e.t0===t.SegmentationDepth.SHAPE?45:48;break;case 22:return f=this.context.getStroke(h.strokeID),e.next=25,this.context.segmentsProducer.buildStrokeSegments(f);case 25:return p=e.sent,this.context.updateTree(h,p),u=u.concat(p),r=!0,e.abrupt("break",49);case 30:for(d=[],y=this.context.getBrushApplier(h.strokeID),v=this.context.curvatureInterpolator.build(h.spline),m=y.build(v),g=0;g<v.length-1;g++)b=this.buildSplineSegment2(h,g,v,m),d.push(b);return this.context.updateTree(h,d),u=u.concat(d),r=!0,e.abrupt("break",49);case 39:return h.convex=this.context.convexHullChainProducer.build(h.shapesPath),h.depth=t.SegmentationDepth.CONVEX,r=!0,e.abrupt("break",49);case 43:if(h.convex.intersects(a))if(this.mode==t.Mode.PARTIAL_STROKE){for(x=[],P=this.context.getBrushApplier(h.strokeID),w=this.context.distanceInterpolator.build(h.spline),E=P.build(w),S=0;S<w.length;S++)k=this.buildPointSegment2(h,S,w,E),x.push(k);this.context.updateTree(h,x),u=u.concat(x),r=!0}else this.nodes2.push(h),this.context.unload(h);return e.abrupt("break",49);case 45:return this.nodes2.push(h),this.context.unload(h),e.abrupt("break",49);case 48:throw new Error("Invalid node depth found: ".concat(h.depth));case 49:e.next=17;break;case 51:e.next=56;break;case 53:e.prev=53,e.t1=e.catch(15),c.e(e.t1);case 56:return e.prev=56,c.f(),e.finish(56);case 59:if(u.length>0&&this.context.load(u),!r){e.next=66;break}return e.next=63,this.updateSegmentationAsync(n);case 63:return e.abrupt("break",69);case 66:this.context.tree.canvas&&this.context.tree.canvas.refresh();case 67:e.next=8;break;case 69:e.next=74;break;case 71:e.prev=71,e.t2=e.catch(6),i.e(e.t2);case 74:return e.prev=74,i.f(),e.finish(74);case 77:case"end":return e.stop()}}),e,this,[[6,71,74,77],[15,53,56,59]])}))),function(t){return n.apply(this,arguments)})},{key:"buildSplineSegment",value:function(e,n,r,i,o){var a=new hr(i[n],i[n+1]),s=this.buildShapeSegment(n+1,e.spline,r,i);return{strokeID:e.strokeID,segmentIndex:e.segmentIndex,splineIndex:n,bounds:a.bounds,spline:new Be(e.spline.layout,e.spline.points,e.spline.pointProps,r.getPointT(n),r.getPointT(n+1)),shapesPath:a,sPoint:o,fPoint:s,depth:t.SegmentationDepth.SPLINE_SEGMENT}}},{key:"buildSplineSegment2",value:function(e,n,r,i){var o=new hr(i[n],i[n+1]);return{strokeID:e.strokeID,segmentIndex:e.segmentIndex,splineIndex:n,bounds:o.bounds,spline:new Be(e.spline.layout,e.spline.points,e.spline.pointProps,r.getPointT(n),r.getPointT(n+1)),shapesPath:o,depth:t.SegmentationDepth.SPLINE_SEGMENT}}},{key:"buildShapeSegment",value:function(t,e,n,r){var i=r[t],o=i.bounds,a=n.getPointT(t),s=n.getPointT(t-1),u=n.getPointT(t+1);if(isNaN(s)&&(s=e.ts),isNaN(u)&&(u=e.tf),o.width!=o.height){var c=Math.max(o.width,o.height);o=new je(o.center.x-c/2,o.center.y-c/2,c,c)}return{shape:i,prevT:s,t:a,nextT:u,bounds:o}}},{key:"buildPointSegment",value:function(e,n){var r=0==n?e.sPoint:e.fPoint;return{strokeID:e.strokeID,segmentIndex:e.segmentIndex,splineIndex:e.splineIndex,pointIndex:n,spline:e.spline,bounds:r.bounds,prevT:r.prevT,t:r.t,nextT:r.nextT,shape:r.shape,depth:t.SegmentationDepth.SHAPE}}},{key:"buildPointSegment2",value:function(e,n,r,i){var o=this.buildShapeSegment(n,e.spline,r,i);return{strokeID:e.strokeID,segmentIndex:e.segmentIndex,splineIndex:e.splineIndex,pointIndex:n,spline:e.spline,bounds:o.bounds,prevT:o.prevT,t:o.t,nextT:o.nextT,shape:o.shape,depth:t.SegmentationDepth.SHAPE}}},{key:"createIntervals",value:function(t,e){var n={intersected:{},selected:[]};if(0==e.length)return n;var r=this.holesBuilder.build(this.context,t instanceof Set?Array.from(t):t,e);for(var i in r){var o=r[i],a=this.context.getNodes(i),s=[],u=[];n.intersected[i]={intervals:s,holes:u};var c,l=$r(o);try{for(l.s();!(c=l.n()).done;){var h=c.value,f=0==h.fromPointIndex&&h.fromTValue==a.first.ts,p=h.toPointIndex==a.last.segmentIndex&&h.toTValue==a.last.tf;if(f&&p)n.selected.push(i),delete n.intersected[i];else{u.push(h),this.context.tree.canvas&&this.context.tree.canvas.addOperation("drawIntersection",e,this.context.getNodes(h.strokeID).slice(h.fromNodeIndex,h.toNodeIndex+1));var d=void 0;f?d={fromPointIndex:h.toPointIndex,fromTValue:h.toTValue,fromNodeIndex:h.toNodeIndex}:p?(s.last||s.push({fromPointIndex:0,fromTValue:a.first.spline.ts,fromNodeIndex:0}),s.last.toPointIndex=h.fromPointIndex+3,s.last.toTValue=h.fromTValue,s.last.toNodeIndex=h.fromNodeIndex):s.last?(s.last.toPointIndex=h.fromPointIndex+3,s.last.toTValue=h.fromTValue,s.last.toNodeIndex=h.fromNodeIndex,d={fromPointIndex:h.toPointIndex,fromTValue:h.toTValue,fromNodeIndex:h.toNodeIndex}):(s.push({fromPointIndex:0,fromTValue:a.first.spline.ts,toPointIndex:h.fromPointIndex+3,toTValue:h.fromTValue,fromNodeIndex:0,toNodeIndex:h.fromNodeIndex}),d={fromPointIndex:h.toPointIndex,fromTValue:h.toTValue,fromNodeIndex:h.toNodeIndex}),d&&s.push(d),h!=o.last||p||(s.last.toPointIndex=a.last.segmentIndex+3,s.last.toTValue=a.last.spline.tf,s.last.toNodeIndex=a.length-1)}}}catch(t){l.e(t)}finally{l.f()}for(var y=[],v=function(){var t=g[m];if(1==t.fromTValue){var e=a.filter((function(e){return e.segmentIndex==t.fromPointIndex+1})).first,n=a.filter((function(e){return e.segmentIndex==t.fromPointIndex}));u.push({fromNodeIndex:n.first.nodeIndex||a.indexOf(n.first),toNodeIndex:n.last.nodeIndex||a.indexOf(n.last),type:"OVERLAPPING_INC"}),t.fromPointIndex++,t.fromTValue=0,t.fromNodeIndex=a.indexOf(e)}if(0==t.toTValue){var r=t.toPointIndex-3,i=a.filter((function(t){return t.segmentIndex==r-1})).last,o=a.filter((function(t){return t.segmentIndex==r}));u.push({fromNodeIndex:o.first.nodeIndex||a.indexOf(o.first),toNodeIndex:o.last.nodeIndex||a.indexOf(o.last),type:"OVERLAPPING_DEC"}),t.toPointIndex--,t.toTValue=1,t.toNodeIndex=a.indexOf(i)}if(t.toPointIndex-t.fromPointIndex<3)y.push(t);else if(t.toPointIndex-t.fromPointIndex==3&&t.fromTValue>=t.toTValue){var s=a.filter((function(e){return e.segmentIndex==t.fromPointIndex}));u.push({fromNodeIndex:s.first.nodeIndex||a.indexOf(s.first),toNodeIndex:s.last.nodeIndex||a.indexOf(s.last),type:"INVALID"}),y.push(t)}},m=0,g=s;m<g.length;m++)v();s.remove.apply(s,y),0==s.length&&(n.selected.includes(i)||n.selected.push(i),delete n.intersected[i])}return n}},{key:"reset",value:function(t){if(!t)throw new Error("Required spatial context not found");this.context=t,this.nodes=new Set,this.nodes2=[],this.context.tree.canvas&&this.context.tree.canvas.refresh()}}],[{key:"buildStrokeNode",value:function(e){return{strokeID:e.id,bounds:e.bounds,depth:t.SegmentationDepth.STROKE_BOUNDS}}},{key:"buildStrokeSegment",value:function(e,n,r,i){if(r<0||r>=n.segmentsCount)throw new Error("Invalid index ".concat(r," found. Ensure that index range is {0, ").concat(n.segmentsCount-1,"}."));var o=.166666666666,a=n.getSegment(r),s=a.getPoint(0),u=a.getPoint(1),c=a.getPoint(2),l=a.getPoint(3),h=-o*s.x+u.x+o*c.x,f=-o*s.y+u.y+o*c.y,p=+o*u.x+c.x-o*l.x,d=+o*u.y+c.y-o*l.y,y=u.toArray(a.layout).concat(c.toArray(a.layout)),v=new Xe(a.layout,y,a.pointProps),m=i.build(v),g=m.first.bounds,b=m.last.bounds,x=Math.max(g.width,b.height),P=Math.max(g.height,b.height),w=Math.max(x,P),E=new je(h-w/2,f-P/2,w,w),S=new je(p-w/2,d-P/2,w,w);return{strokeID:e,segmentIndex:r,bounds:g.union(b).union(E).union(S),spline:a,depth:t.SegmentationDepth.STROKE_SEGMENT}}}]),t}();function ei(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return ni(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ni(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ni(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ri(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=c(t);if(e){var i=c(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u(this,n)}}ti.SegmentationDepth={STROKE_BOUNDS:0,STROKE_SEGMENT:1,SPLINE_SEGMENT:2,CONVEX:3,SHAPE:4},Object.defineEnum(ti,"Mode",["WHOLE_STROKE","PARTIAL_STROKE"]),function(t){o(i,t);var n=ri(i);function i(){var t;return e(this,i),(t=n.call(this)).splines={},t.brushes={},t.brushAppliers={},t}return r(i,[{key:"process",value:function(t){var e={action:t.action,actionID:t.actionID};switch(t.action){case"IMPORT_BRUSHES":this.importBrushes(t.brushes);break;case"IMPORT_SPLINE":this.importSpline(t.strokeID,t.spline);break;case"REMOVE_SPLINE":this.removeSpline(t.strokeID);break;case"BUILD_STROKE_SEGMENT":var n=t.strokeID,r=t.brushName,i=t.index,o=this.buildStrokeSegment(n,i,r);e.bounds=o.bounds.toJSON(),e.spline=o.spline.toJSON(),e.depth=o.depth,o.spline.points.buffer instanceof ArrayBuffer&&this.transferables.push(o.spline.points.buffer),e.index=t.index;break;default:throw new Error("Unknow data action found: ".concat(t.action))}return e}},{key:"importBrushes",value:function(t){var e,n=ei(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(!this.brushes[r.name]){if("Brush2D"!=r.type)throw new Error("BrushGL is not supported");this.brushes[r.name]=kr.fromJSON(r)}}}catch(t){n.e(t)}finally{n.f()}}},{key:"importSpline",value:function(t,e){this.splines[t]||(this.splines[t]=Be.fromJSON(e))}},{key:"removeSpline",value:function(t){delete this.splines[t]}},{key:"buildStrokeSegment",value:function(t,e,n){if(!this.splines[t])throw new Error("Stroke spline ".concat(t," expected. Import spline first."));var r=this.brushAppliers[n];if(!r){var i=this.brushes[n];if(!i)throw new Error("".concat(n," expected. Import brushes first."));r=new dr(i),this.brushAppliers[i.name]=r}return ti.buildStrokeSegment(t,this.splines[t],e,r)}}]),i}(Q).connect()}();
